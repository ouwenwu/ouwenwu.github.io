<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Ouwenwu">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Ouwenwu">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ouwenwu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Ouwenwu</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Ouwenwu" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Ouwenwu</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">个人学习日志</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/ouwenwu/ouwenwu.github.io" class="github-corner" title="Ouwenwu Github" aria-label="Ouwenwu Github" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/25/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E5%B8%B8%E8%A7%81%E6%89%8B%E5%86%99%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/25/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E5%B8%B8%E8%A7%81%E6%89%8B%E5%86%99%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">常见手写函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-25 15:48:32" itemprop="dateCreated datePublished" datetime="2023-03-25T15:48:32+08:00">2023-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-05 18:42:47" itemprop="dateModified" datetime="2023-04-05T18:42:47+08:00">2023-04-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、柯里化函数"><a href="#一、柯里化函数" class="headerlink" title="一、柯里化函数"></a>一、柯里化函数</h1><p><strong><em>柯里化：</em></strong></p>
<p>把接收多个参数的函数，变成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数，而且返回 结果的新函数的技术</p>
<p>只传递给函数一部分参数来调用它，让它返回一个函数去处理剩余的参数</p>
<h2 id="实现多数字加法的柯里化"><a href="#实现多数字加法的柯里化" class="headerlink" title="实现多数字加法的柯里化"></a>实现多数字加法的柯里化</h2><p><strong><em>加法函数：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add0 = <span class="keyword">function</span>(<span class="params">x,y,z</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y + z</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>柯里化函数：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add1 = <span class="keyword">function</span>(<span class="params">x</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">y</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">z</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> x + y + z</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>箭头函数优化：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">add2</span> = x=&gt;<span class="function"><span class="params">y</span>=&gt;</span><span class="function"><span class="params">z</span>=&gt;</span>x+y+z</span><br></pre></td></tr></table></figure>
<p><strong><em>考虑会同时传递进去1个或2个参数</em></strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title function_">add3</span> = (<span class="params">...args</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(args.<span class="property">length</span>===<span class="number">3</span>) <span class="keyword">return</span> args.<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev,curr</span>)=&gt;</span>prev+curr)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...other</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">add3</span>(...args,...other)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 未考虑传入参数大于3个时的边界情况</span></span><br></pre></td></tr></table></figure>
<p><strong><em>如果我们想得到可以获取不同个参数的柯里化函数呢，自动柯里化：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = <span class="keyword">function</span>(<span class="params">x,y,z,g</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> x+y+z+g</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> curryMyFn= <span class="keyword">function</span>(<span class="params">fn</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> curryFn = <span class="keyword">function</span>(<span class="params">...args</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(args.<span class="property">length</span>&gt;=fn.<span class="property">length</span>) <span class="keyword">return</span> <span class="title function_">fn</span>(...args)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params">...newArgs</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">curryFn</span>(...args.<span class="title function_">concat</span>(newArgs))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="title function_">curryMyFn</span>(fn)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">bar</span>(<span class="number">10</span>,<span class="number">20</span>)(<span class="number">40</span>,<span class="number">50</span>))</span><br></pre></td></tr></table></figure>
<h1 id="二、apply、call、bind的手写"><a href="#二、apply、call、bind的手写" class="headerlink" title="二、apply、call、bind的手写"></a>二、apply、call、bind的手写</h1><p><a href>this绑定</a></p>
<ul>
<li>this绑定共4种，默认绑定、隐式绑定、显示绑定、new绑定</li>
<li>实现显示绑定即是通过其余简单绑定方式实现，而默认绑定的this一般为windows，所以这里只能用隐式绑定实现</li>
</ul>
<h2 id="apply与call的手写实现"><a href="#apply与call的手写实现" class="headerlink" title="apply与call的手写实现"></a>apply与call的手写实现</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过symbol实现apply</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply</span> = <span class="keyword">function</span>(<span class="params">thisArgs, args</span>)&#123;</span><br><span class="line">    thisArgs = (thisArgs===<span class="literal">null</span> || thisArgs ===<span class="literal">undefined</span>)?<span class="attr">window</span>:<span class="title class_">Object</span>(thisArgs)</span><br><span class="line">    <span class="keyword">let</span> symbol = <span class="title class_">Symbol</span>()</span><br><span class="line">    thisArgs[symbol] = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">let</span> fn = thisArgs[symbol](...args)</span><br><span class="line">    <span class="keyword">delete</span> thisArgs[symbol]</span><br><span class="line">    <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过symbol实现call</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myCall</span> = <span class="keyword">function</span>(<span class="params">thisArgs, ...args</span>)&#123;</span><br><span class="line">    thisArgs = (thisArgs===<span class="literal">null</span> || thisArgs ===<span class="literal">undefined</span>)?<span class="attr">window</span>:<span class="title class_">Object</span>(thisArgs)</span><br><span class="line">    <span class="keyword">let</span> symbol = <span class="title class_">Symbol</span>()</span><br><span class="line">    thisArgs[symbol] = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">let</span> fn = thisArgs[symbol](...args)</span><br><span class="line">    <span class="keyword">delete</span> thisArgs[symbol]</span><br><span class="line">    <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不通过symbol、定义属性不可枚举</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply1</span> = <span class="keyword">function</span>(<span class="params">thisArgs, args</span>)&#123;</span><br><span class="line">    thisArgs = (thisArgs===<span class="literal">null</span> || thisArgs ===<span class="literal">undefined</span>)?<span class="attr">window</span>:<span class="title class_">Object</span>(thisArgs)</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(thisArgs, <span class="string">&quot;temp&quot;</span>,&#123;</span><br><span class="line">        <span class="attr">configurable</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="title class_">Enumerable</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">value</span>:<span class="variable language_">this</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> fn = thisArgs[<span class="string">&quot;temp&quot;</span>](...args)</span><br><span class="line">    <span class="keyword">delete</span> thisArgs[<span class="string">&quot;temp&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不通过symbol且不定义属性不可枚举</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myApply2</span> = <span class="keyword">function</span>(<span class="params">thisArgs, args</span>)&#123;</span><br><span class="line">    thisArgs = (thisArgs===<span class="literal">null</span> || thisArgs ===<span class="literal">undefined</span>)?<span class="attr">window</span>:<span class="title class_">Object</span>(thisArgs)</span><br><span class="line">    thisArgs.<span class="property">temp</span> = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">let</span> fn = thisArgs.<span class="title function_">temp</span>(...args)</span><br><span class="line">    <span class="keyword">delete</span> thisArgs.<span class="property">temp</span></span><br><span class="line">    <span class="keyword">return</span> fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>首先要排除thisArgs为null或undefined的情况，同时对数字或字符串包装为对象（Object(object)还是object）</li>
<li>方法添加到Function的原型上，使得所有函数都可以直接调用</li>
<li>使用symbol是因为Symbol()可以创建出一个独一无二的值，那么肯定不会覆盖掉原来对象中可能存在的值，同时Symbol属性不可以通过简单的属性获取得到，在后续的逻辑编写中不会出现错误</li>
<li>如果不适用Symbol，则需要通过Object.defineProperty使其不可枚举<a href>Object.defineProperty</a></li>
</ul>
<p><strong><em>测试：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> bar = <span class="keyword">function</span>(<span class="params">name,age</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>),name,age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bar.<span class="title function_">myApply</span>(&#123;<span class="attr">method</span>:<span class="string">&quot;myApply-symbol&quot;</span>&#125;,[<span class="string">&quot;ouwenwu&quot;</span>,<span class="number">18</span>])</span><br><span class="line">bar.<span class="title function_">myApply1</span>(&#123;<span class="attr">method</span>:<span class="string">&quot;myApply-没有symbol-不枚举&quot;</span>&#125;,[<span class="string">&quot;ouwenwu&quot;</span>,<span class="number">18</span>])</span><br><span class="line">bar.<span class="title function_">myApply2</span>(&#123;<span class="attr">method</span>:<span class="string">&quot;myApply-没有symbol-枚举&quot;</span>&#125;,[<span class="string">&quot;ouwenwu&quot;</span>,<span class="number">18</span>])</span><br><span class="line">bar.<span class="title function_">apply</span>(&#123;<span class="attr">method</span>:<span class="string">&quot;apply-js自带&quot;</span>&#125;,[<span class="string">&quot;ouwenwu&quot;</span>,<span class="number">18</span>])</span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/25/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E5%B8%B8%E8%A7%81%E6%89%8B%E5%86%99%E5%87%BD%E6%95%B0/image-20230326222135494.png" alt="image-20230326222135494"></p>
<p><strong><em>综上：</em></strong>直接使用symbol属性来完成手写</p>
<h2 id="bind的手写实现"><a href="#bind的手写实现" class="headerlink" title="bind的手写实现"></a>bind的手写实现</h2><p>根据上面的经验，这里直接用symbol</p>
<p>bind与apply、call的区别主要是返回一个函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myBind</span> = <span class="keyword">function</span>(<span class="params">thisArgs,...args</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> symbol = <span class="title class_">Symbol</span>()</span><br><span class="line">    thisArgs[symbol] = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...args</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> thisArgs[symbol](...args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="三、es5继承的实现"><a href="#三、es5继承的实现" class="headerlink" title="三、es5继承的实现"></a>三、es5继承的实现</h1><p><strong><em>继承：子类继承父类的函数与属性</em></strong></p>
<p><strong><em>注：类具有显示原型、对象具有隐式原型</em></strong></p>
<h2 id="1-原型链继承"><a href="#1-原型链继承" class="headerlink" title="1.原型链继承"></a>1.原型链继承</h2><p><strong>父类的实例化对象作为子类的显示原型——就可以通过原型链去访问得到父类的属性与方法</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name,age</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">name</span> = name,</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">age</span> = age</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eating</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;eating&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;oww&quot;</span>, <span class="number">23</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params">sno</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">sno</span> = sno</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span> = person</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">studying</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;studying&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> student = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;111&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        student.<span class="title function_">eating</span>()</span></span><br><span class="line"><span class="language-javascript">        student.<span class="title function_">studying</span>()</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/25/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E5%B8%B8%E8%A7%81%E6%89%8B%E5%86%99%E5%87%BD%E6%95%B0/image-20230405183113993.png" alt="image-20230405183113993"></p>
<p><strong><em>有一个很大的弊端：某些属性其实是保存在p对象上的：</em></strong></p>
<ul>
<li>我们通过直接打印对象是看不到这个属性的</li>
<li>这个属性会被多个对象共享，如果这个对象是一个引用类型，那么就会造成问题——其他子类修改会同时改变这边</li>
<li>不能给Person传递参数（让每个stu有自己的属性），因为这个对象是一次性创建的（没办法定制化）——子类的name、age在student中写死了</li>
</ul>
<h2 id="2-借用构造函数继承"><a href="#2-借用构造函数继承" class="headerlink" title="2.借用构造函数继承"></a>2.借用构造函数继承</h2><p><strong><em>原型链继承子类中的属性是通过父类实例定义的，没有自己的属性，不能传入值更改，借用构造函数可以解决这个问题</em></strong></p>
<ul>
<li>通过apply()和call()方法也可以在新创建的对象上执行父类构造函数</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/25/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/25/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/" class="post-title-link" itemprop="url">事件总线</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-25 12:40:46 / 修改时间：16:24:00" itemprop="dateCreated datePublished" datetime="2023-03-25T12:40:46+08:00">2023-03-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="事件总线（EventBus）"><a href="#事件总线（EventBus）" class="headerlink" title="事件总线（EventBus）"></a>事件总线（EventBus）</h1><p>事件总线是一种观察者模式，包括三个角色</p>
<ul>
<li><strong><em>发布者：</em></strong>发布事件</li>
<li><strong><em>订阅者：</em></strong>订阅事件，并进行响应</li>
<li><strong><em>时间总线：</em></strong>无论发布者还是订阅者都通过事件总线作为中台</li>
</ul>
<p><strong><em>目的：</em></strong>开发过程中不同组件之间通信 <a href>组件通信</a></p>
<h2 id="事件总线的实现"><a href="#事件总线的实现" class="headerlink" title="事件总线的实现"></a>事件总线的实现</h2><ul>
<li>事件的监听方法on</li>
<li>事件的发射方法emit</li>
<li>事件的取消监听off</li>
</ul>
<p>由于一个EventBus对象会在多个地方使用，所以将其中的属性和函数定义为静态的</p>
<p>也可采用实例化的方法，那样需要把这个实例放在全局变量中，如在React在根节点定义Context</p>
<p><strong><em>EventBus的实现：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EventBus</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> eventMap = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">on</span>(<span class="params">eventName, eventFn</span>)&#123;</span><br><span class="line">        (<span class="variable language_">this</span>.<span class="property">eventMap</span>[eventName] || (<span class="variable language_">this</span>.<span class="property">eventMap</span>[eventName] = []))&amp;&amp;<span class="variable language_">this</span>.<span class="property">eventMap</span>[eventName].<span class="title function_">push</span>(eventFn)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">emit</span>(<span class="params">eventName, ...args</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">eventMap</span>[eventName])&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(eventName,<span class="string">&quot;没有监听&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> fun <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">eventMap</span>[eventName])&#123;</span><br><span class="line">            fun.<span class="title function_">apply</span>(<span class="variable language_">this</span>,args)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">off</span>(<span class="params">eventName, eventFn</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> eventFns = <span class="variable language_">this</span>.<span class="property">eventMap</span>[eventName]</span><br><span class="line">        <span class="keyword">if</span>(!eventFns)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(eventName,<span class="string">&quot;没有监听&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;eventFns.<span class="property">length</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(eventFn===eventFns[i])&#123;</span><br><span class="line">                eventFns.<span class="title function_">splice</span>(i,<span class="number">1</span>)</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">eventMap</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>EventBus的使用：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> function1 = <span class="keyword">function</span>(<span class="params">...args</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;function1&quot;</span>, <span class="variable language_">this</span>.<span class="property">eventMap</span>, args)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> function2 = <span class="keyword">function</span>(<span class="params">...args</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;function2&quot;</span>, <span class="variable language_">this</span>.<span class="property">eventMap</span>, args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">EventBus</span>.<span class="title function_">on</span>(<span class="string">&quot;click&quot;</span>,function1)</span><br><span class="line"><span class="title class_">EventBus</span>.<span class="title function_">on</span>(<span class="string">&quot;click&quot;</span>,function2)</span><br><span class="line"></span><br><span class="line"><span class="title class_">EventBus</span>.<span class="title function_">on</span>(<span class="string">&quot;click2&quot;</span>,function1)</span><br><span class="line"></span><br><span class="line"><span class="title class_">EventBus</span>.<span class="title function_">emit</span>(<span class="string">&quot;click&quot;</span>, <span class="string">&quot;oww&quot;</span>, <span class="string">&quot;18&quot;</span>)</span><br><span class="line"><span class="title class_">EventBus</span>.<span class="title function_">emit</span>(<span class="string">&quot;click2&quot;</span>, <span class="string">&quot;oww1&quot;</span>, <span class="string">&quot;22&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="title class_">EventBus</span>.<span class="title function_">off</span>(<span class="string">&quot;click&quot;</span>,function2)</span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/25/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/image-20230325134633475.png" alt="image-20230325134633475"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A0%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A0%86/" class="post-title-link" itemprop="url">堆</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-24 19:22:13 / 修改时间：21:27:40" itemprop="dateCreated datePublished" datetime="2023-03-24T19:22:13+08:00">2023-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="堆："><a href="#堆：" class="headerlink" title="堆："></a>堆：</h1><ul>
<li>堆是一种<strong>完全二叉树</strong>，复习一下完全二叉树的定义，完全二叉树的形式是指除了最后一层之外，其他所有层的结点都是满的，而最后一层的所有结点都靠左边。</li>
<li>若设二叉树的深度为h，除第 h 层外，其它各层 (1～h-1) 的结点数都达到最大个数，第 h 层所有的结点都连续集中在最左边，这就是完全二叉树。</li>
</ul>
<p><img src="/2023/03/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A0%86/image-20230324192427183.png" alt="image-20230324192427183"></p>
<p><strong><em>完全二叉树：</em></strong>对于任意一个父节点的序号n来说（这里n从0算），它的子节点的序号一定是2n+1,2n+2，因此我们可以直接用数组来表示一个堆。</p>
<p><strong><em>堆的创建：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Heap</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">array</span> = []</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A0%86/image-20230324192636065.png" alt="image-20230324192636065"></p>
<h2 id="大顶堆-最大堆："><a href="#大顶堆-最大堆：" class="headerlink" title="大顶堆/最大堆："></a>大顶堆/最大堆：</h2><p>对于任意一个父节点来说，其子节点都小于这个父节点</p>
<h3 id="最大堆的插入："><a href="#最大堆的插入：" class="headerlink" title="最大堆的插入："></a>最大堆的插入：</h3><ul>
<li>当一个元素要插入时，先放到堆尾，根据堆的特性，对位置进行调整。</li>
<li>父节点要大于直接点，找到插入节点的父节点，比父节点值大则交换位置，否则插入成功</li>
<li>交换后，继续检测该节点与现在父节点的大小，如果大则交换位置，一直上浮到根节点</li>
</ul>
<p><img src="/2023/03/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A0%86/image-20230324193433568.png" alt="image-20230324193433568"></p>
<p><strong><em>JavaScript实现：</em></strong>length可以用this.array.length替代</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">insert</span>(<span class="params">x</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">array</span>.<span class="title function_">push</span>(x)</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>===<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> x_index = <span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>-<span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> parent_index = x_index</span><br><span class="line">    <span class="keyword">while</span>(parent_index!==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> parent_index = x_index%<span class="number">2</span>===<span class="number">0</span>?(x_index-<span class="number">2</span>):(x_index-<span class="number">1</span>)</span><br><span class="line">        parent_index = parent_index/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">array</span>[parent_index]&lt;x)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">array</span>[x_index] = <span class="variable language_">this</span>.<span class="property">array</span>[parent_index]</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">array</span>[parent_index] = x</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        x_index = parent_index</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 循环最大次数k即为树的深度：2^0+2^1+...+2^k = n 即k=logn 时间复杂度为O(logN)</span></span><br></pre></td></tr></table></figure>
<h3 id="最大堆的删除"><a href="#最大堆的删除" class="headerlink" title="最大堆的删除"></a>最大堆的删除</h3><ul>
<li>堆的删除一般是值删除堆顶元素，先删除堆顶元素</li>
<li>要保证堆一直为完全二叉树，不能直接拿子节点的较大值，而是将末尾元素拿到堆顶，再下沉</li>
<li>下沉即先比较该节点与左子节点，如果子节点更大，则交换，如果子节点更小，则与右节点比较</li>
<li>直至到最深层，或者比左右子节点都大</li>
</ul>
<p><strong><em>JavaScript实现：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">pop</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">array</span>[<span class="number">0</span>] = <span class="variable language_">this</span>.<span class="property">array</span>[<span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>-<span class="number">1</span>]</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">array</span>.<span class="title function_">pop</span>()</span><br><span class="line">    <span class="keyword">let</span> x_index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> left_index = <span class="number">2</span> * x_index + <span class="number">1</span></span><br><span class="line">        <span class="keyword">let</span> right_index = <span class="number">2</span> * x_index + <span class="number">2</span></span><br><span class="line">        left_index = left_index&gt;=<span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>?<span class="attr">x_index</span>:left_index</span><br><span class="line">        right_index = right_index&gt;=<span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>?<span class="attr">x_index</span>:right_index</span><br><span class="line">        <span class="keyword">let</span> large_child_index = <span class="variable language_">this</span>.<span class="property">array</span>[x_index]&lt;<span class="variable language_">this</span>.<span class="property">array</span>[left_index]?<span class="attr">left_index</span>:x_index</span><br><span class="line">        large_child_index = large_child_index!==x_index?<span class="attr">large_child_index</span>:(<span class="variable language_">this</span>.<span class="property">array</span>[x_index]&lt;<span class="variable language_">this</span>.<span class="property">array</span>[right_index]?<span class="attr">right_index</span>:x_index)</span><br><span class="line">        <span class="keyword">if</span>(large_child_index===x_index) <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">let</span> temp = <span class="variable language_">this</span>.<span class="property">array</span>[x_index]</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">array</span>[x_index] = <span class="variable language_">this</span>.<span class="property">array</span>[large_child_index]</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">array</span>[large_child_index] = temp</span><br><span class="line">        x_index = large_child_index</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 最大循环次数k即为树的深度 k = logn 时间复杂度为O(logN)</span></span><br></pre></td></tr></table></figure>
<h1 id="小顶堆-最小堆"><a href="#小顶堆-最小堆" class="headerlink" title="小顶堆/最小堆"></a>小顶堆/最小堆</h1><p>插入与删除与最大堆类似</p>
<p><strong><em>插入JavaScript实现：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">insert</span>(<span class="params">x</span>)&#123;</span><br><span class="line">    <span class="keyword">debugger</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">array</span>.<span class="title function_">push</span>(x)</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>===<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> x_index = <span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>-<span class="number">1</span></span><br><span class="line">    <span class="keyword">let</span> parent_index = x_index</span><br><span class="line">    <span class="keyword">while</span>(parent_index!==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> parent_index = x_index%<span class="number">2</span>===<span class="number">0</span>?(x_index-<span class="number">2</span>):(x_index-<span class="number">1</span>)</span><br><span class="line">        parent_index = parent_index/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">array</span>[parent_index]&gt;x)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">array</span>[x_index] = <span class="variable language_">this</span>.<span class="property">array</span>[parent_index]</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">array</span>[parent_index] = x</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        x_index = parent_index</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A0%86/image-20230324210219667.png" alt="image-20230324210219667"></p>
<p><strong><em>删除JavaScript实现：</em></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">pop</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">debugger</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">array</span>[<span class="number">0</span>] = <span class="variable language_">this</span>.<span class="property">array</span>[<span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>-<span class="number">1</span>]</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">array</span>.<span class="title function_">pop</span>()</span><br><span class="line">    <span class="keyword">let</span> x_index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> left_index = <span class="number">2</span> * x_index + <span class="number">1</span></span><br><span class="line">        <span class="keyword">let</span> right_index = <span class="number">2</span> * x_index + <span class="number">2</span></span><br><span class="line">        left_index = left_index&gt;=<span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>?<span class="attr">x_index</span>:left_index</span><br><span class="line">        right_index = right_index&gt;=<span class="variable language_">this</span>.<span class="property">array</span>.<span class="property">length</span>?<span class="attr">x_index</span>:right_index</span><br><span class="line">        <span class="keyword">let</span> small_child_index = <span class="variable language_">this</span>.<span class="property">array</span>[x_index]&gt;<span class="variable language_">this</span>.<span class="property">array</span>[left_index]?<span class="attr">left_index</span>:x_index</span><br><span class="line">        small_child_index = small_child_index!==x_index?<span class="attr">small_child_index</span>:(<span class="variable language_">this</span>.<span class="property">array</span>[x_index]&gt;<span class="variable language_">this</span>.<span class="property">array</span>[right_index]?<span class="attr">right_index</span>:x_index)</span><br><span class="line">        <span class="keyword">if</span>(small_child_index===x_index) <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">let</span> temp = <span class="variable language_">this</span>.<span class="property">array</span>[x_index]</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">array</span>[x_index] = <span class="variable language_">this</span>.<span class="property">array</span>[small_child_index]</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">array</span>[small_child_index] = temp</span><br><span class="line">        x_index = small_child_index</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A0%86/image-20230324210321704.png" alt="image-20230324210321704"></p>
<h1 id="解决前K个高频元素-低频元素题"><a href="#解决前K个高频元素-低频元素题" class="headerlink" title="解决前K个高频元素/低频元素题"></a>解决前K个高频元素/低频元素题</h1><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/top-k-frequent-elements/">LeetCode链接</a></p>
<p>给定一个非空的整数数组，返回其中出现频率前 k 高的元素。</p>
<p>示例 1:</p>
<ul>
<li>输入: nums = [1,1,1,2,2,3], k = 2</li>
<li>输出: [1,2]</li>
</ul>
<p>示例 2:</p>
<ul>
<li>输入: nums = [1], k = 1</li>
<li>输出: [1]</li>
</ul>
<p>提示：</p>
<ul>
<li>你可以假设给定的 k 总是合理的，且 1 ≤ k ≤ 数组中不相同的元素的个数。</li>
<li>你的算法的时间复杂度必须优于 $O(n \log n)$ , n 是数组的大小。</li>
<li>题目数据保证答案唯一，换句话说，数组中前 k 个高频元素的集合是唯一的。</li>
<li>你可以按任意顺序返回答案。</li>
</ul>
<p><strong><em>步骤：</em></strong></p>
<ul>
<li>获取到每个数据出现的频率，使用哈希表，这里可以用map，key是数字，value是次数</li>
<li>对频率排序</li>
<li>找出前K个高频元素</li>
</ul>
<p>注：</p>
<ul>
<li>如果使用快速排序的时间复杂度为O(n)</li>
<li>仅维护大小为K的小顶堆，小顶堆的堆顶始终是最小值，如果堆长度小于K则继续往队礼添加，如果长度大于K则弹出堆顶的最小值</li>
</ul>
<p><img src="/2023/03/24/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%A0%86/image-20230324211848724.png" alt="image-20230324211848724"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// js 没有堆 需要自己构造</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Heap</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">compareFn</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">compareFn</span> = compareFn;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">queue</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加</span></span><br><span class="line">    <span class="title function_">push</span>(<span class="params">item</span>) &#123;</span><br><span class="line">        <span class="comment">// 推入元素</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">push</span>(item);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 上浮</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="title function_">size</span>() - <span class="number">1</span>; <span class="comment">// 记录推入元素下标</span></span><br><span class="line">        <span class="keyword">let</span> parent = <span class="title class_">Math</span>.<span class="title function_">floor</span>((index - <span class="number">1</span>) / <span class="number">2</span>); <span class="comment">// 记录父节点下标</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (parent &gt;= <span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">compare</span>(parent, index) &gt; <span class="number">0</span>) &#123; <span class="comment">// 注意compare参数顺序</span></span><br><span class="line">            [<span class="variable language_">this</span>.<span class="property">queue</span>[index], <span class="variable language_">this</span>.<span class="property">queue</span>[parent]] = [<span class="variable language_">this</span>.<span class="property">queue</span>[parent], <span class="variable language_">this</span>.<span class="property">queue</span>[index]];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 更新下标</span></span><br><span class="line">            index = parent;</span><br><span class="line">            parent = <span class="title class_">Math</span>.<span class="title function_">floor</span>((index - <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取堆顶元素并移除</span></span><br><span class="line">    <span class="title function_">pop</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 堆顶元素</span></span><br><span class="line">        <span class="keyword">const</span> out = <span class="variable language_">this</span>.<span class="property">queue</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 移除堆顶元素 填入最后一个元素</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">queue</span>[<span class="number">0</span>] = <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="title function_">pop</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下沉</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="number">0</span>; <span class="comment">// 记录下沉元素下标</span></span><br><span class="line">        <span class="keyword">let</span> left = <span class="number">1</span>; <span class="comment">// left 是左子节点下标 left + 1 则是右子节点下标</span></span><br><span class="line">        <span class="keyword">let</span> searchChild = <span class="variable language_">this</span>.<span class="title function_">compare</span>(left, left + <span class="number">1</span>) &gt; <span class="number">0</span> ? left + <span class="number">1</span> : left;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (searchChild !== <span class="literal">undefined</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">compare</span>(index, searchChild) &gt; <span class="number">0</span>) &#123; <span class="comment">// 注意compare参数顺序</span></span><br><span class="line">            [<span class="variable language_">this</span>.<span class="property">queue</span>[index], <span class="variable language_">this</span>.<span class="property">queue</span>[searchChild]] = [<span class="variable language_">this</span>.<span class="property">queue</span>[searchChild], <span class="variable language_">this</span>.<span class="property">queue</span>[index]];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 更新下标</span></span><br><span class="line">            index = searchChild;</span><br><span class="line">            left = <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">            searchChild = <span class="variable language_">this</span>.<span class="title function_">compare</span>(left, left + <span class="number">1</span>) &gt; <span class="number">0</span> ? left + <span class="number">1</span> : left;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">size</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">queue</span>.<span class="property">length</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用传入的 compareFn 比较两个位置的元素</span></span><br><span class="line">    <span class="title function_">compare</span>(<span class="params">index1, index2</span>) &#123;</span><br><span class="line">        <span class="comment">// 处理下标越界问题</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">queue</span>[index1] === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">queue</span>[index2] === <span class="literal">undefined</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">compareFn</span>(<span class="variable language_">this</span>.<span class="property">queue</span>[index1], <span class="variable language_">this</span>.<span class="property">queue</span>[index2]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> topKFrequent = <span class="keyword">function</span> (<span class="params">nums, k</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> num <span class="keyword">of</span> nums) &#123;</span><br><span class="line">        map.<span class="title function_">set</span>(num, (map.<span class="title function_">get</span>(num) || <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建小顶堆</span></span><br><span class="line">    <span class="keyword">const</span> heap= <span class="keyword">new</span> <span class="title class_">Heap</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a[<span class="number">1</span>] - b[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// entry 是一个长度为2的数组，0位置存储key，1位置存储value</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> map.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">        heap.<span class="title function_">push</span>(entry);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (heap.<span class="title function_">size</span>() &gt; k) &#123;</span><br><span class="line">            heap.<span class="title function_">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return heap.queue.map(e =&gt; e[0]);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = heap.<span class="title function_">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        res[i] = heap.<span class="title function_">pop</span>()[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>由于key和value是要绑定的，所以元素不能是简单的数组，而应该是包含key和value的二维数组，同时为了使得代码重用，将比较函数抽取出来，当做参数传递</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/24/%E5%90%84%E7%A7%8D%E7%AE%97%E6%B3%95/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6-%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/24/%E5%90%84%E7%A7%8D%E7%AE%97%E6%B3%95/%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6-%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/" class="post-title-link" itemprop="url">时间复杂度-空间复杂度</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-24 18:56:00 / 修改时间：19:21:45" itemprop="dateCreated datePublished" datetime="2023-03-24T18:56:00+08:00">2023-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h1><p><strong><em>时间复杂度：</em></strong>时间增长趋势 T(n) = O(f(n))</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// let i=0   1</span></span><br><span class="line"><span class="comment">// i&lt;=n; i++; x++ 各n次</span></span><br><span class="line"><span class="comment">// 结果为 O(1+3n) = O(n)   O(n)算n趋近无限大，所以常数忽略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;=n;j++)&#123;</span><br><span class="line">		x++</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 时间复杂度：O(n)*O(n)=O(n^2)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">	x++</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;=n;j++)&#123;</span><br><span class="line">		x++</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 时间复杂度 O(n+n^2) = O(n^2)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> y = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> temp = x</span><br><span class="line">x = y</span><br><span class="line">y = temp</span><br><span class="line"><span class="comment">// 时间复杂度不随着任何一个变量增大而增大，复杂度为O(1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span>(i&lt;n)&#123;</span><br><span class="line">    i = i*<span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 循环次数k：2^k = n k=logn O(logn)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;=n;j++)&#123;</span><br><span class="line">	<span class="keyword">let</span> i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(i&lt;n)&#123;</span><br><span class="line">        i = i*<span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 时间复杂度O(n)*O(logn) = O(nlogn)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;=m;j++)&#123;</span><br><span class="line">		x++</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 时间复杂度O(n)*O(m) = O(nm)</span></span><br></pre></td></tr></table></figure>
<h1 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h1><p><strong><em>空间复杂度：</em></strong>内存空间增长的趋势</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> y = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> temp = x</span><br><span class="line">x = y</span><br><span class="line">y = temp</span><br><span class="line"><span class="comment">// x和y无论多大多不会影响空间占用 O(1)</span></span><br><span class="line"><span class="keyword">let</span> arr = []</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">	arr.<span class="title function_">push</span>(i)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 占用空间与n成正比，O(n)</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/" class="post-title-link" itemprop="url">React组件化开发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-24 17:13:16" itemprop="dateCreated datePublished" datetime="2023-03-24T17:13:16+08:00">2023-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-27 22:05:07" itemprop="dateModified" datetime="2023-03-27T22:05:07+08:00">2023-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="组件化开发（React二）"><a href="#组件化开发（React二）" class="headerlink" title="组件化开发（React二）"></a>组件化开发（React二）</h1><p><strong><em>组件化开发：</em></strong>如果把一个页面的所有处理逻辑放在一起，处理起来会很复杂，因此将一个页面拆分为不同的功能块</p>
<ul>
<li>一个完整的页面可以划分为很多个组件</li>
<li>每个组件都用于实现页面的一个功能</li>
<li>每一个组件又可以细分</li>
<li>组件本身又可以在很多地方复用</li>
</ul>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230324172119865.png" alt="image-20230324172119865"></p>
<p><strong><em>React组件：</em></strong></p>
<ul>
<li>类组件与函数组件</li>
<li>根据内部是否有状态需要维护：无状态组件、有状态组件（this.state，不考虑hooks的情况下函数组件是无状态组件，而类组件不定义this.state也可以看做无状态组件）</li>
<li>根据组件的不同职责：展示型组件、容器型组件</li>
</ul>
<p><strong><em>组件之间有重叠，但都是为了数据逻辑和UI展示的分离</em></strong></p>
<ul>
<li>函数组件、无状态组件、展示型组件主要关注UI的展示</li>
<li>类组件、有状态组件、容器型组件主要关注数据逻辑</li>
</ul>
<h1 id="类组件与函数组件"><a href="#类组件与函数组件" class="headerlink" title="类组件与函数组件"></a>类组件与函数组件</h1><h2 id="类组件"><a href="#类组件" class="headerlink" title="类组件"></a>类组件</h2><p><strong><em>定义要求：</em></strong>首字母大写、继承自React.Component、实现render函数</p>
<ul>
<li>constructor可选，在其中初始化数据</li>
<li>this.state中维护组件内部的数据</li>
<li>render是类组件<strong>唯一必须实现的方法</strong></li>
</ul>
<h2 id="函数组件（没有hooks的函数组件）"><a href="#函数组件（没有hooks的函数组件）" class="headerlink" title="函数组件（没有hooks的函数组件）"></a>函数组件（没有hooks的函数组件）</h2><ul>
<li>没有生命周期、会被挂载、没有生命周期函数</li>
<li>this关键字不能指向组件实例，因为没有组件实例</li>
<li>没有内部状态state</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#root&#x27;</span>))</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>)</span><br></pre></td></tr></table></figure>
<h1 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h1><p><strong><em>生命周期：</em></strong>从创建到销毁的整个过程，了解生命周期在最合适的地方完成想要的功能</p>
<h2 id="React的生命周期、生命周期函数"><a href="#React的生命周期、生命周期函数" class="headerlink" title="React的生命周期、生命周期函数"></a>React的生命周期、生命周期函数</h2><ul>
<li>装载阶段：组件第一次在DOM树种被渲染的过程——装载完成：componentDidMount</li>
<li>更新阶段：组件状态发生变化，重新更新渲染的过程——更新完成：componentDidUpdate</li>
<li>卸载阶段：组件从DOM树种被移除的过程——即将移除：componentWillUnmount</li>
</ul>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230324173626696.png" alt="image-20230324173626696"></p>
<h3 id="各函数任务及时刻"><a href="#各函数任务及时刻" class="headerlink" title="各函数任务及时刻"></a>各函数任务及时刻</h3><p><strong><em>constructor：</em></strong></p>
<ul>
<li>不初始化state或不进行方法绑定，则可以不实现构造函数</li>
<li>作用一：给this.state赋值对象来初始化state</li>
<li>作用二：为事件绑定this——调用super()</li>
</ul>
<p><strong><em>componentDidMount：</em></strong></p>
<ul>
<li>组件挂载到DOM Tree后立马调用</li>
<li>作用一：进行依赖于DOM的操作</li>
<li>作用二：发送网络请求的最好位置</li>
<li>作用三：添加订阅</li>
</ul>
<p><strong><em>componentDidUpdate：</em></strong></p>
<ul>
<li>组件更新后立即调用，首次渲染不会执行这个方法</li>
<li>作用一：组件更新后，此处进行DOM相关操作</li>
<li>作用二：当更新前后props发送了变化，此处发送网络请求</li>
</ul>
<p><strong><em>componentWIllUnmount：</em></strong></p>
<ul>
<li>组件卸载及销毁之前直接调用</li>
<li>作用一：进行必要的清理操作</li>
<li>作用二：清除timer，取消网络请求或取消上面创建的订阅</li>
</ul>
<h3 id="不常用生命周期函数"><a href="#不常用生命周期函数" class="headerlink" title="不常用生命周期函数"></a>不常用生命周期函数</h3><ul>
<li>getDerivedStateFromProps：state 的值在任何 时候都依赖于 props时使用；该方法返回一个对象 来更新state</li>
<li>getSnapshotBeforeUpdate：在React更新DOM 之前回调的一个函数，可以获取DOM更新前的一 些信息（比如说滚动位置）</li>
<li>shouldComponentUpdate：该生命周期函数很 常用，但是我们等待讲性能优化时再来详细讲解</li>
</ul>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230324174415395.png" alt="image-20230324174415395"></p>
<h1 id="组件之间的通信"><a href="#组件之间的通信" class="headerlink" title="组件之间的通信"></a>组件之间的通信</h1><h2 id="父组件传值到子组件"><a href="#父组件传值到子组件" class="headerlink" title="父组件传值到子组件"></a>父组件传值到子组件</h2><ul>
<li>父组件通过 属性=值 的形式来传递给子组件数据</li>
<li>子组件通过props参数获取父组件传过来的值</li>
</ul>
<p><strong><em>默认值设置：</em></strong>ChildComponent.defaultProps</p>
<p><strong><em>参数类型设置：</em></strong>ChildComponent.propTypes    isRequired代表是否必须</p>
<p><strong><em>父组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;I am your father!&quot;</span>,</span><br><span class="line">            <span class="attr">info</span>:<span class="string">&quot;You are my child!&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;message,info&#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;message&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">info</span> = <span class="string">&#123;info&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><strong><em>子组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PropTypes</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ([</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span>&gt;</span>&#123;this.props.info&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>&#123;this.props.info2&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ChildComponent</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">    <span class="attr">info</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ChildComponent</span>.<span class="property">defaultProps</span> = &#123;</span><br><span class="line">    <span class="attr">info</span>:<span class="string">&quot;Tell me who are you!&quot;</span>,</span><br><span class="line">    <span class="attr">info2</span>:<span class="string">&quot;You are my Dad!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230324180859034.png" alt="image-20230324180859034"></p>
<h2 id="子组件传值到父组件"><a href="#子组件传值到父组件" class="headerlink" title="子组件传值到父组件"></a>子组件传值到父组件</h2><ul>
<li>通过props给子组件传递一个回调函数，在子组件中调用这个函数</li>
</ul>
<p><strong><em>父组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;I am your father!&quot;</span>,</span><br><span class="line">            <span class="attr">info</span>:<span class="string">&quot;You are my child!&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dataFromChild = <span class="keyword">function</span>(<span class="params">info</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">message</span>:info</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;message,info&#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;message&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">info</span> = <span class="string">&#123;info&#125;</span> <span class="attr">dataFromChild</span> = <span class="string">&#123;(message)</span>=&gt;</span> this.dataFromChild(message)&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><em>子组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PropTypes</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    sendDataToFather = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">dataFromChild</span>(<span class="number">555</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ([</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">onClick</span> = <span class="string">&#123;()</span>=&gt;</span>&#123;this.sendDataToFather()&#125;&#125;&gt;&#123;this.props.info&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span>&gt;</span>&#123;this.props.info2&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ChildComponent</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">    <span class="attr">info</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ChildComponent</span>.<span class="property">defaultProps</span> = &#123;</span><br><span class="line">    <span class="attr">info</span>:<span class="string">&quot;Tell me who are you!&quot;</span>,</span><br><span class="line">    <span class="attr">info2</span>:<span class="string">&quot;You are my Dad!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p>注：各个地方函数的使用要注意，是否需要this，一般传递过去的函数都是箭头函数，调用的函数一般为function</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">ChildComponent</span> info = &#123;info&#125; dataFromChild = &#123;<span class="function">(<span class="params">message</span>)=&gt;</span> <span class="variable language_">this</span>.<span class="title function_">dataFromChild</span>(message)&#125;/&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">info</span> = <span class="string">&#123;info&#125;</span> <span class="attr">dataFromChild</span> = <span class="string">&#123;this.dataFromChild&#125;/</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>如果直接传递，那么函数的调用由React确定就不知道this是啥</p>
<p>传递过去箭头函数，那么我们不关心什么时候调用这个箭头函数，而箭头函数包含的是隐式绑定的this，所以调用的函数需要function，要不然找不到this</p>
<h2 id="React中实现插槽"><a href="#React中实现插槽" class="headerlink" title="React中实现插槽"></a>React中实现插槽</h2><p>为了使组件具有更好的通用性，组件的内容不能限制为固定的div、span等，因此父组件传元素到子组件中，使得元素类型可以多变</p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230324214907031.png" alt="image-20230324214907031"></p>
<h3 id="通过组件的children子元素实现（父像子传元素）"><a href="#通过组件的children子元素实现（父像子传元素）" class="headerlink" title="通过组件的children子元素实现（父像子传元素）"></a>通过组件的children子元素实现（父像子传元素）</h3><p><strong><em>子组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;children&#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;children[0]&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;children[1]&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;children[2]&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p><strong><em>父组件代码1：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ChildComponent</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ChildComponent</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><strong><em>结果：</em></strong></p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230324215146004.png" alt="image-20230324215146004"></p>
<p><strong><em>更改父组件的子元素</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">ChildComponent</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">i</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">ChildComponent</span>&gt;</span><br></pre></td></tr></table></figure>
<p><strong><em>结果：</em></strong></p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230324215351358.png" alt="image-20230324215351358"></p>
<h3 id="通过props实现插槽（父向子传元素）"><a href="#通过props实现插槽（父向子传元素）" class="headerlink" title="通过props实现插槽（父向子传元素）"></a>通过props实现插槽（父向子传元素）</h3><ul>
<li>上面描述过通过props传值到子元素，props可以传的值不仅仅有JavaScript对象，React对象也可以作为参数传过去</li>
<li>可以避免通过children获取时索引不能精准的获取传入的元素</li>
</ul>
<p><strong><em>父组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> spanJSX = <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">        <span class="keyword">const</span> iJSX = <span class="language-xml"><span class="tag">&lt;<span class="name">i</span>&gt;</span>标题<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">        <span class="keyword">const</span> buttonJSX = <span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">spanJSX</span>=<span class="string">&#123;spanJSX&#125;</span> <span class="attr">iJSX</span> = <span class="string">&#123;iJSX&#125;</span> <span class="attr">buttonJSX</span>=<span class="string">&#123;buttonJSX&#125;/</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><strong><em>子组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;spanJSX,iJSX,buttonJSX&#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;spanJSX&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;iJSX&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;buttonJSX&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p><strong><em>结果：</em></strong></p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230324220143962.png" alt="image-20230324220143962"></p>
<h3 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h3><ul>
<li>上面两种插槽方法子组件接受到的都是有父组件写死的元素，但某些时候在子组件中需要根据状态更改组件的内容</li>
<li>所以需要实现元素类型父组件决定，数据或状态子组件决定</li>
<li>类似于这种由父组件子组件共同协作完成的，通常使用传递函数实现</li>
</ul>
<p><strong><em>父组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">itemtyPE</span> = <span class="string">&#123;item</span>=&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#125;/&gt;</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p>子组件代码：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;itemtyPE&#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="keyword">const</span> message = <span class="string">&quot;哈哈哈&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;itemtyPE(message)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230325112140472.png" alt="image-20230325112140472"></p>
<h2 id="非直接父子组件的通信"><a href="#非直接父子组件的通信" class="headerlink" title="非直接父子组件的通信"></a>非直接父子组件的通信</h2><p><strong><em>常见方法：</em></strong></p>
<ul>
<li>通过props属性自上而下传递</li>
<li>但是对于某些数据需要在多个组件中共享（如地区、用户信息等等）</li>
<li>如果在顶层App定义这些信息，一层层传递下去，对于一些中间层不需要这些数据的组件来说，是一种冗余的<strong>操作</strong></li>
</ul>
<p><strong><em>Context方法：</em></strong></p>
<ul>
<li>context提供了一种在组件之间共享值的方法，而不必显示的通过树的逐层传递props</li>
<li>context的目的是共享对于组件树来说是“全局的数据”，如当前用户、主题</li>
</ul>
<h3 id="注册Context"><a href="#注册Context" class="headerlink" title="注册Context"></a>注册Context</h3><p>由于后续会在多个组件中用到这个Context1，所以将Context1的注册放到一个js文件中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Context1</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Context1</span></span><br></pre></td></tr></table></figure>
<h3 id="Context值的设置"><a href="#Context值的设置" class="headerlink" title="Context值的设置"></a>Context值的设置</h3><p><strong><em>父组件设置：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&quot;./context/Context1&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 通过COntext1.Provider 包围要传递值的子组件，那么这个子组件及其后代组件都可以获取到传递的值</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Context1.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;color:</span>&quot;<span class="attr">red</span>&quot;,<span class="attr">size:18</span>&#125;&#125;&gt;</span>  </span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ChildComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Context1.Provider</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<h3 id="Context值的获取"><a href="#Context值的获取" class="headerlink" title="Context值的获取"></a>Context值的获取</h3><p><strong><em>后代类组件Context值的获取：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&#x27;../context/Context1&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GrandsonComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./GrandsonComponent&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:this.context.color&#125;&#125;</span>&gt;</span>子组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">GrandsonComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ChildComponent</span>.<span class="property">contextType</span> = <span class="title class_">Context1</span> <span class="comment">// 通过设置contextType为this.context指定Context，然后通过this.context获取值</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p><strong><em>后代函数组件Context值获取：</em></strong></p>
<p>由于函数组件中没有this，所以不能够使用上面类组件获取值的方法，使用Context.Consumer获取值</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&quot;../context/Context1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">GrandsonFunComponent</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Context1.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;</span></span><br><span class="line"><span class="language-xml">                value=&gt;&#123;</span></span><br><span class="line"><span class="language-xml">                    return <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:value.color&#125;&#125;</span>&gt;</span>函数孙子组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Context1.Consumer</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">GrandsonFunComponent</span></span><br></pre></td></tr></table></figure>
<h3 id="多个Context的注册与获取"><a href="#多个Context的注册与获取" class="headerlink" title="多个Context的注册与获取"></a>多个Context的注册与获取</h3><p><strong><em>注册第二个Context：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Context2</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Context2</span></span><br></pre></td></tr></table></figure>
<p><strong><em>单组件设置多Context：</em></strong></p>
<p>父组件采用Context嵌套的方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&quot;./context/Context1&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context2</span> <span class="keyword">from</span> <span class="string">&quot;./context/Context2&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Context2.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;color:</span>&quot;<span class="attr">blue</span>&quot;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Context1.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;color:</span>&quot;<span class="attr">red</span>&quot;,<span class="attr">size:18</span>&#125;&#125;&gt;</span> </span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ChildComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Context1.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Context2.Provider</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><strong><em>后代组件获取多Context：</em></strong></p>
<p>通过设置contextType与Context.Consumer组合获取多个Context</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&#x27;../context/Context1&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context2</span> <span class="keyword">from</span> <span class="string">&#x27;../context/Context2&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GrandsonComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./GrandsonComponent&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GrandsonFunComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./GrandsonFunComponent&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:this.context.color&#125;&#125;</span>&gt;</span>子组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Context2.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;</span></span><br><span class="line"><span class="language-xml">                        value=&gt;&#123;</span></span><br><span class="line"><span class="language-xml">                            return <span class="tag">&lt;<span class="name">h3</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:value.color&#125;&#125;</span>&gt;</span>子组件2<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        &#125;</span></span><br><span class="line"><span class="language-xml">                    &#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Context2.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">GrandsonComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">GrandsonFunComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ChildComponent</span>.<span class="property">contextType</span> = <span class="title class_">Context1</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<h3 id="Context默认值的使用"><a href="#Context默认值的使用" class="headerlink" title="Context默认值的使用"></a>Context默认值的使用</h3><p>使用了Context但不是Context.Provider的后代元素</p>
<p><strong><em>Context的注册（带默认值）：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Context1</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(&#123;<span class="attr">color</span>:<span class="string">&quot;green&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Context1</span></span><br></pre></td></tr></table></figure>
<p><strong><em>Context的设置：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&quot;./context/Context1&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context2</span> <span class="keyword">from</span> <span class="string">&quot;./context/Context2&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Context2.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;color:</span>&quot;<span class="attr">blue</span>&quot;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Context1.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;color:</span>&quot;<span class="attr">red</span>&quot;,<span class="attr">size:18</span>&#125;&#125;&gt;</span> </span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">ChildComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Context1.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Context2.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ChildComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><strong><em>Context的获取：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&#x27;../context/Context1&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context2</span> <span class="keyword">from</span> <span class="string">&#x27;../context/Context2&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GrandsonComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./GrandsonComponent&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">GrandsonFunComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./GrandsonFunComponent&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:this.context.color&#125;&#125;</span>&gt;</span>子组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">GrandsonComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">GrandsonFunComponent</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">ChildComponent</span>.<span class="property">contextType</span> = <span class="title class_">Context1</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230325122726808.png" alt="image-20230325122726808"></p>
<h2 id="任意组件之间的通信——事件总线（EventBus）"><a href="#任意组件之间的通信——事件总线（EventBus）" class="headerlink" title="任意组件之间的通信——事件总线（EventBus）"></a>任意组件之间的通信——事件总线（EventBus）</h2><p><a href>事件总线实现</a></p>
<h1 id="setState的细节原理"><a href="#setState的细节原理" class="headerlink" title="setState的细节原理"></a>setState的细节原理</h1><p><strong><em>为什么要setState：</em></strong>React没有数据劫持，直接更改this.state时，React不知道数据已经发生了变化，需要通过this.setState()来告知React数据发生了变化，需要刷新页面</p>
<h2 id="setState的异步-同步"><a href="#setState的异步-同步" class="headerlink" title="setState的异步/同步"></a>setState的异步/同步</h2><p>一般情况下，setSTate是异步的</p>
<p><strong><em>设置为异步的原因：</em></strong></p>
<ul>
<li>可以显著提升性能，如果每次调用setState都进行一次更新，那么render会频繁的调用，界面重新渲染，这样效率很低（可以联系到回流-重绘），因此设置为异步获取到数据的多次更新，之后批量更新</li>
<li>如果同步更新了state，但还没执行render函数，那么state与子组件的props不能保持同步，可能出现若干问题</li>
</ul>
<p><strong><em>setState批量更新方法</em></strong></p>
<ul>
<li>获取到一系列setState的更新值，按先后顺序把旧的state与新的state合并（添加新的属性、更新改变了的属性），在最后将合并好的state赋值给this.state并刷新到页面上（SCU优化）</li>
<li><strong><em>注意：</em></strong>先合并再赋值给this.state</li>
</ul>
<h3 id="异步结果的获取："><a href="#异步结果的获取：" class="headerlink" title="异步结果的获取："></a>异步结果的获取：</h3><p>既然是异步，那么我们便不知道更新啥时候结束，但有些时候又想在更新结束后进行一定的操作，这个操作应该在哪里进行？</p>
<h4 id="方法一：setState的回调函数"><a href="#方法一：setState的回调函数" class="headerlink" title="方法一：setState的回调函数"></a>方法一：setState的回调函数</h4><ul>
<li>setState接受两个参数：新的state+回调函数</li>
<li>回调执行顺序：render-&gt;componentDidUpdate（因此也可以在这个生命周期函数中对更新结束后的值操作）-&gt;setState回调</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">            <span class="attr">counter</span>:<span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">buttonClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">counter</span>:<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">counter</span> + <span class="number">1</span></span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">counter</span>:<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">counter</span> + <span class="number">1</span></span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">counter</span>:<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">counter</span> + <span class="number">1</span></span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidUpdate&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123; counter &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;counter&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;this.buttonClick()&#125;&#125;&gt;更新state<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327111305434.png" alt="image-20230327111305434"></p>
<p>注：</p>
<ul>
<li>多次setState合并，一次render，一次componentDidUpdate，多次回调</li>
<li>这里多次一个提交了3次+1，但是最后结果只加了1，是因为this.state会在多次提交的state与原始state合并结束后再赋值给this.state，也就是这里获取到的this.state每次都是初始值3，相当于提交了3次 counter=4</li>
</ul>
<p><strong><em>this.setState的第一个参数也可以是一个函数：</em></strong></p>
<ul>
<li>返回值是要更改的值</li>
<li>参数是已经合并后的state而不是this.state</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">            <span class="attr">counter</span>:<span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">buttonClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTimeOut宏任务&quot;</span>)</span><br><span class="line">        &#125;,<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise微任务&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState&quot;</span>,state)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">counter</span>:state.<span class="property">counter</span>+<span class="number">1</span>&#125;</span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">counter</span>:state.<span class="property">counter</span>+<span class="number">1</span>&#125;</span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">counter</span>:state.<span class="property">counter</span>+<span class="number">1</span>&#125;</span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidUpdate&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123; counter &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;counter&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;this.buttonClick()&#125;&#125;&gt;更新state<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p>执行顺序为：this.setState第一个参数函数-&gt;render-&gt;componentDidUpdate-&gt;this回调</p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327112819884.png" alt="image-20230327112819884"></p>
<p>注：</p>
<ul>
<li>多次setState合并，一次render，一次componentDidUpdate，多次回调</li>
<li>setState函数执行、render、componentDidUpdate执行都是在微任务后，宏任务前，因此前面的函数应该都是放在微任务队列中</li>
<li>提交3次+1，最后得到的结果也和预期相同，因为将3次setState的第一个参数函数放入微任务队列中，在原来的state基础上进行更改，然后合并，得到新的state，在调用下一个微任务setState时，用前面合并好的state作为参数，再进行更改与合并操作</li>
<li>虽然setState中是在微任务中分3次调用，但setState的回调是在完成componentDidUpdate再放入微队列中，此时this.state已经更改为最后值，所以获取到的都是最后结果</li>
</ul>
<p><strong><em>回调的好处：</em></strong></p>
<ul>
<li>在数据更改后处理一些state的逻辑</li>
<li>回调函数会把之前的state和props传入进来</li>
<li>由于setState是一个异步函数，所以对更新后值的处理要放入回调中</li>
</ul>
<h4 id="方法二：组件的生命周期函数componentDidUpdate"><a href="#方法二：组件的生命周期函数componentDidUpdate" class="headerlink" title="方法二：组件的生命周期函数componentDidUpdate"></a>方法二：组件的生命周期函数componentDidUpdate</h4><p>上面已讲</p>
<h3 id="setState的同步"><a href="#setState的同步" class="headerlink" title="setState的同步"></a>setState的同步</h3><ul>
<li>React18之前，在组件生命周期和React合成事件中，setState是异步</li>
<li>React18之前，在setTimeout或者原生dom事件中，setState是同步</li>
</ul>
<p>注：</p>
<ul>
<li>由React去决定运行时机的大多是异步</li>
<li>由setTimeout/或者原生Dom的响应函数中调用这种用户编写决定运行时机的一般是同步</li>
</ul>
<p><strong><em>React18之后，setState默认都是异步的</em></strong></p>
<h4 id="React18之后获取同步的setState"><a href="#React18之后获取同步的setState" class="headerlink" title="React18之后获取同步的setState"></a>React18之后获取同步的setState</h4><p>使用特殊的flushSync操作</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;flushSync&#125; <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span></span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">            <span class="attr">counter</span>:<span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">buttonClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTimeOut宏任务&quot;</span>)</span><br><span class="line">        &#125;,<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise微任务&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title function_">flushSync</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState&quot;</span>,state)</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="attr">counter</span>:state.<span class="property">counter</span>+<span class="number">1</span>&#125;</span><br><span class="line">            &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">counter</span>:state.<span class="property">counter</span>+<span class="number">1</span>&#125;</span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function">(<span class="params">state</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">counter</span>:state.<span class="property">counter</span>+<span class="number">1</span>&#125;</span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setState回调&quot;</span>,<span class="variable language_">this</span>.<span class="property">state</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidUpdate&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123; counter &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;counter&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;this.buttonClick()&#125;&#125;&gt;更新state<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327114712050.png" alt="image-20230327114712050"></p>
<p>可以看到使用flushSync中的setState在微任务执行之前就已经运行，说明flushSync确实将setState更改为同步方式运行</p>
<h1 id="React的SCU优化"><a href="#React的SCU优化" class="headerlink" title="React的SCU优化"></a>React的SCU优化</h1><h2 id="React更新机制"><a href="#React更新机制" class="headerlink" title="React更新机制"></a>React更新机制</h2><p><strong><em>React渲染流程：</em></strong></p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327115317127.png" alt="image-20230327115317127"></p>
<p><strong><em>React更新流程：</em></strong></p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327120054249.png" alt="image-20230327120054249">                                                                                                                                                                                                                                                                                                                                            </p>
<p><strong>React在props或state发生改变时，会调用React的render方法，会创建一颗新树，React会基于新树与旧树的不同去判断如何有效的更新UI</strong></p>
<ul>
<li>如果两棵树进行完全比较更新，算法的时间复杂度为O(n^3)，n为树中元素的数量，开销太大，React的更新性能会变得低效</li>
</ul>
<h3 id="React对diff算法的优化："><a href="#React对diff算法的优化：" class="headerlink" title="React对diff算法的优化："></a>React对diff算法的优化：</h3><ul>
<li>同层节点之间相互比较，不会跨节点比较</li>
<li>不同类型的节点，产生不同的树结构</li>
<li>开发中，通过key来指定哪些节点在不同的渲染下保持稳定</li>
</ul>
<p><strong><em>keys的优化：</em></strong></p>
<ul>
<li>在最后位置插入数据，有无key意义不大</li>
<li>在前面插入数据，没有key，所有的li都需要更改，有key，后续的li只需要移动</li>
</ul>
<p><strong><em>key的注意事项：</em></strong></p>
<ul>
<li>key应该是唯一的</li>
<li>key不能使用随机数，每次render的随机数不同</li>
<li>不能使用index作为key，index在操作后也可能会改变，要使用一个不会随render改变的值</li>
</ul>
<h2 id="shouldComponentUpdate优化（即SCU优化）"><a href="#shouldComponentUpdate优化（即SCU优化）" class="headerlink" title="shouldComponentUpdate优化（即SCU优化）"></a>shouldComponentUpdate优化（即SCU优化）</h2><p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327121337396.png" alt="image-20230327121337396"></p>
<ul>
<li>在上图中，如果App中值发生了改变，那么App的render函数会重新执行，而在App的执行过程中，会执行其所有子组件的render函数，都进行diff算法，性能很低</li>
<li>子组件调用render函数应该有一个前提——依赖的数据state/props发生改变，此时才调用render函数</li>
</ul>
<h3 id="shouldComponentUpdate函数"><a href="#shouldComponentUpdate函数" class="headerlink" title="shouldComponentUpdate函数"></a>shouldComponentUpdate函数</h3><ul>
<li>参数：nextProps（修改后的pros）、nextState（修改之后的state）</li>
<li>返回值：true（调用render方法）、false（不调用render方法）、默认返回true（只要state改变就会调用render方法）</li>
</ul>
<p>在值发生变化时，就可以在shouldComponentUpdate监听自己的state和props是否发生变化从而觉得是否进行render</p>
<h3 id="类组件PureComponent"><a href="#类组件PureComponent" class="headerlink" title="类组件PureComponent"></a>类组件PureComponent</h3><p>继承自PureComponent自动实现了SCU优化，不需要自己去编写shouldComponentUpdate函数</p>
<p>如果使用Component，只要调用setState就会执行render函数，而PureComponent会帮我们实现比较setState后state是否改变，如果改变才执行render</p>
<h4 id="不可变数据的力量"><a href="#不可变数据的力量" class="headerlink" title="不可变数据的力量"></a>不可变数据的力量</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;flushSync&#125; <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span></span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">            <span class="attr">books</span>:[</span><br><span class="line">                &#123;<span class="attr">name</span>:<span class="string">&quot;aaa&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">name</span>:<span class="string">&quot;bbb&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">name</span>:<span class="string">&quot;ccc&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">name</span>:<span class="string">&quot;ddd&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">addNewBook</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> newBook = &#123;<span class="attr">name</span>:<span class="string">&quot;eee&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> &#123; books &#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;books.map((item,index)=&gt;&#123;</span></span><br><span class="line"><span class="language-xml">                        return(</span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">span</span>&gt;</span>name:&#123;item.name&#125;-count:&#123;item.count&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">button</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        )</span></span><br><span class="line"><span class="language-xml">                    &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span>=&gt;</span>this.addNewBook()&#125;&gt;添加新书<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p>上述在setState中没进行任何操作，但render依然会执行，而改成PureComponent时不会执行</p>
<p><strong><em>PureComponent中render执行要求：</em></strong></p>
<ul>
<li>PureComponent在比较时底层会使用shallowEqual方法，shallowEqual是一种浅层比较，如果比较的两个对象是同一个，则不会调用render，即使this.state发生了改变，也不会调用render</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">super</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">        <span class="attr">books</span>:[</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&quot;aaa&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&quot;bbb&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&quot;ccc&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&quot;ddd&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">addNewBook</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> newBook = &#123;<span class="attr">name</span>:<span class="string">&quot;eee&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">books</span>.<span class="title function_">push</span>(newBook)</span><br><span class="line">    <span class="keyword">const</span> books = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">books</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">books</span>:books</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果要想在这种情况下调用render，可以利用books创建一个新的对象，用这个对象去更改state，在这种情况下，即使未更改this.state的，也会调用render</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">super</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">        <span class="attr">books</span>:[</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&quot;aaa&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&quot;bbb&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&quot;ccc&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">name</span>:<span class="string">&quot;ddd&quot;</span>,<span class="attr">count</span>:<span class="number">1</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">addNewBook</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> books = [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">books</span>]</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">books</span>:books</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="函数组件memo"><a href="#函数组件memo" class="headerlink" title="函数组件memo"></a>函数组件memo</h3><p>函数由于不能继承于PureComponent，可以使用memo替代，即用memo包裹原来的函数组件</p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327131630892.png" alt="image-20230327131630892"></p>
<h1 id="获取原生DOM或获取组件"><a href="#获取原生DOM或获取组件" class="headerlink" title="获取原生DOM或获取组件"></a>获取原生DOM或获取组件</h1><p>在React的开发模式中，通常情况下不需要、也不建议直接操作DOM原生，但是某些特殊的情况，确实需要获取到DOM进行某些操作：</p>
<ul>
<li>管理焦点，文本选择或媒体播放； </li>
<li>触发强制动画； </li>
<li>集成第三方  DOM 库； </li>
<li>我们可以通过refs获取DOM；</li>
</ul>
<h2 id="通过refs获取DOM的方式："><a href="#通过refs获取DOM的方式：" class="headerlink" title="通过refs获取DOM的方式："></a>通过refs获取DOM的方式：</h2><ul>
<li><strong><em>传入字符串：</em></strong>使用时通过 this.refs.传入的字符串 格式获取对应的元素</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">addNewBook</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">refs</span>.<span class="property">button</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span>=&gt;</span>this.addNewBook()&#125; ref=&quot;button&quot;&gt;查看DOM<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong><em>传入一个对象：</em></strong>通过React.createRef()方式创建一个对象，使用使用对象的current属性来访问DOM</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">titleRef</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">addNewBook</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">titleRef</span>.<span class="property">current</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span>=&gt;</span>this.addNewBook()&#125; ref=&#123;this.titleRef&#125;&gt;查看DOM<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong><em>传入一个函数：</em></strong>该函数会在DOM被挂载时回调，回调函数会传入一个元素对象，我们可以访问并保存</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">titleRef</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">ref</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123;console.log(e)&#125;&#125;&gt;查看DOM<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<h2 id="通过refs获取组件的方式："><a href="#通过refs获取组件的方式：" class="headerlink" title="通过refs获取组件的方式："></a>通过refs获取组件的方式：</h2><p><strong><em>针对类组件：</em></strong></p>
<ul>
<li>上面的ref同样可以加在子组件上，获取得到子组件的实例，就可以在父组件中获取子组件对子组件的函数、变量进行操作</li>
</ul>
<p><strong><em>针对函数组件：</em></strong></p>
<ul>
<li>函数组件由于没有实例，是不可能获取到它的</li>
<li>但是在某些情况，想获取得到函数实例中的某个DOM元素，可以使用foreardRef</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; forwardRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="title function_">forwardRef</span>(<span class="keyword">function</span>(<span class="params">props, ref</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">HelloWorldRef</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">ref</span> = <span class="string">&#123;this.HelloWorldRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;console.log(this.HelloWorldRef.current)&#125;&#125;&gt;查看DOM<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<h1 id="受控组件与非受控组件"><a href="#受控组件与非受控组件" class="headerlink" title="受控组件与非受控组件"></a>受控组件与非受控组件</h1><ul>
<li>HTML中，表单元素（input、textarea、select）通常会自己维护state并根据用户的输入进行更新</li>
<li>React中，可变状态通常保存在组件的state属性中，并且只能通过setState来更新</li>
<li>在JSX中，如果给表单元素设置了value属性，显示this.state.value的值，那么表单元素就不会自己维护state，其state来源于React的state，因此当设置了value属性后，input元素输入后输入框里的东西不会变化，相当于未输入</li>
<li>此时只能给input元素添加onChange(e)监听，从而在监听函数中使用输入的值在setState中更改value的值，使得页面刷新</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; forwardRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">            <span class="attr">username</span>:<span class="string">&quot;oww&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">inputChange</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">username</span>:e.<span class="property">target</span>.<span class="property">value</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username&#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&#123;username&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123;this.inputChange(e)&#125;&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<h2 id="计算属性名"><a href="#计算属性名" class="headerlink" title="计算属性名"></a>计算属性名</h2><p>当对多个表单元素变成受控元素时，其更新需要多个监听，此时可用计算属性名将这些监听抽取到一个函数中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; forwardRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">            <span class="attr">username</span>:<span class="string">&quot;oww&quot;</span>,</span><br><span class="line">            <span class="attr">password</span>:<span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">inputChange</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;[e.<span class="property">target</span>.<span class="property">name</span>]:e.<span class="property">target</span>.<span class="property">value</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username,password&#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&#123;username&#125;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123;this.inputChange(e)&#125;&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=<span class="string">&#123;password&#125;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123;this.inputChange(e)&#125;&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<h2 id="checkbox表单多选监听"><a href="#checkbox表单多选监听" class="headerlink" title="checkbox表单多选监听"></a>checkbox表单多选监听</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">            <span class="attr">hobbies</span>:[</span><br><span class="line">                &#123;<span class="attr">id</span>:<span class="string">&quot;sing&quot;</span>,<span class="attr">text</span>:<span class="string">&quot;唱&quot;</span>,<span class="attr">checked</span>:<span class="literal">false</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">id</span>:<span class="string">&quot;jump&quot;</span>,<span class="attr">text</span>:<span class="string">&quot;跳&quot;</span>,<span class="attr">checked</span>:<span class="literal">false</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">id</span>:<span class="string">&quot;rap&quot;</span>,<span class="attr">text</span>:<span class="string">&quot;rap&quot;</span>,<span class="attr">checked</span>:<span class="literal">false</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">inputChange</span>(<span class="params">e,index</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> hobbies = [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hobbies</span>]</span><br><span class="line">        hobbies[index].<span class="property">checked</span> = e.<span class="property">target</span>.<span class="property">checked</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">hobbies</span>:hobbies</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;hobbies&#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>爱好列表<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;hobbies.map((item, index)=&gt;&#123;</span></span><br><span class="line"><span class="language-xml">                    return (</span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>= <span class="string">&#123;item.id&#125;</span> <span class="attr">checked</span>=<span class="string">&#123;item.checked&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span>=&gt;</span>this.inputChange(e,index)&#125;/&gt;&#123;item.text&#125;</span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    )</span></span><br><span class="line"><span class="language-xml">                &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<h2 id="select多选"><a href="#select多选" class="headerlink" title="select多选"></a>select多选</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> =&#123;</span><br><span class="line">            <span class="attr">fruits</span>:[</span><br><span class="line">                &#123;<span class="attr">id</span>:<span class="string">&quot;apple&quot;</span>,<span class="attr">text</span>:<span class="string">&quot;苹果&quot;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">id</span>:<span class="string">&quot;banana&quot;</span>,<span class="attr">text</span>:<span class="string">&quot;香蕉&quot;</span>&#125;,</span><br><span class="line">                &#123;<span class="attr">id</span>:<span class="string">&quot;orange&quot;</span>,<span class="attr">text</span>:<span class="string">&quot;橘子&quot;</span>&#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">checked</span>:[<span class="string">&quot;apple&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">selectChange</span>(<span class="params">e</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> checked = <span class="title class_">Array</span>.<span class="title function_">from</span>(e.<span class="property">target</span>.<span class="property">selectedOptions</span>).<span class="title function_">map</span>(<span class="function"><span class="params">item</span>=&gt;</span>item.<span class="property">value</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">checked</span>:checked</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;fruits,checked&#125; = <span class="variable language_">this</span>.<span class="property">state</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>爱好列表<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">select</span> <span class="attr">multiple</span> <span class="attr">value</span>=<span class="string">&#123;checked&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;e</span>=&gt;</span>this.selectChange(e)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                    &#123;fruits.map(item=&gt;&#123;</span></span><br><span class="line"><span class="language-xml">                        return <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#123;item.id&#125;</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.text&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<h1 id="高阶组件"><a href="#高阶组件" class="headerlink" title="高阶组件"></a>高阶组件</h1><p><strong><em>高阶函数：</em></strong>满足下列一个条件</p>
<ul>
<li>接受一个函数或多个函数作为输入</li>
<li>输出一个函数</li>
</ul>
<p><strong><em>高阶组件（Higher-Order Components、HOC）：</em></strong></p>
<ul>
<li>高阶组件的参数为组件，返回值为新组件的函数</li>
<li>高阶组件本身不是一个组件，而是一个函数</li>
</ul>
<p><strong><em>高阶组件不是React的API，而是基于React组合特性而形成的一种设计模式</em></strong></p>
<h2 id="高阶组件应用——props的增强"><a href="#高阶组件应用——props的增强" class="headerlink" title="高阶组件应用——props的增强"></a>高阶组件应用——props的增强</h2><p><strong><em>HOC代码：</em></strong>高阶函数包裹代码</p>
<p>例如本代码可以将用户信息封装传给子组件，不需要像上面的父向子传值，在子组件中写其他代码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">enhanceProps</span>(<span class="params">WrapperCpn, otherProps</span>)&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">UserComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span>&#123;</span><br><span class="line">        <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">super</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">                <span class="attr">userinfo</span>:&#123;</span><br><span class="line">                    <span class="attr">username</span>:<span class="string">&quot;ouwenwu&quot;</span>,</span><br><span class="line">                    <span class="attr">age</span>:<span class="number">22</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrapperCpn</span> &#123;<span class="attr">...this.state.userinfo</span>&#125; &#123;<span class="attr">...otherProps</span>&#125;/&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">UserComponent</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> enhanceProps</span><br></pre></td></tr></table></figure>
<p><strong><em>父组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> enhanceProps <span class="keyword">from</span> <span class="string">&quot;./HOC/HOC&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title class_">EnhancePropsCpn</span> = <span class="title function_">enhanceProps</span>(<span class="title class_">ChildComponent</span>,&#123;<span class="attr">color</span>:<span class="string">&quot;blue&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">EnhancePropsCpn</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><strong><em>子组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:this.props.color&#125;&#125;</span>&gt;</span>username:&#123;this.props.username&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327211035646.png" alt="image-20230327211035646"></p>
<h2 id="高阶组件应用——Context的共享"><a href="#高阶组件应用——Context的共享" class="headerlink" title="高阶组件应用——Context的共享"></a>高阶组件应用——Context的共享</h2><p><strong><em>HOC代码：</em></strong>HOC可以返回类组件也可以返回函数组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&quot;../context/Context1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">enhanceProps</span>(<span class="params">WrapperCpn</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">props</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Context1.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;</span></span><br><span class="line"><span class="language-xml">                    value=&gt;&#123;</span></span><br><span class="line"><span class="language-xml">                        return <span class="tag">&lt;<span class="name">WrapperCpn</span> &#123;<span class="attr">...value</span>&#125; &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#125;</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Context1.Consumer</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> enhanceProps</span><br></pre></td></tr></table></figure>
<p><strong><em>父组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ChildComponent</span> <span class="keyword">from</span> <span class="string">&quot;./component/ChildComponent&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Context1</span> <span class="keyword">from</span> <span class="string">&quot;./context/Context1&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> enhanceProps <span class="keyword">from</span> <span class="string">&quot;./HOC/HOC&quot;</span>;</span><br><span class="line"><span class="comment">//编写组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title class_">EnhancePropsCpn</span> = <span class="title function_">enhanceProps</span>(<span class="title class_">ChildComponent</span>)</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Context1.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;color:</span>&quot;<span class="attr">red</span>&quot;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">EnhancePropsCpn</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Context1.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span></span><br></pre></td></tr></table></figure>
<p><strong><em>子组件代码：</em></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ChildComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:this.props.color&#125;&#125;</span>&gt;</span>username:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ChildComponent</span></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327212419080.png" alt="image-20230327212419080"></p>
<p>注：可以看出对Context不再需要在每一个子组件中写之前提到的获取Context的方法，只需要将所有需要该Context的子组件包裹在高阶组件之中</p>
<h2 id="高阶组件应用——渲染判断定权"><a href="#高阶组件应用——渲染判断定权" class="headerlink" title="高阶组件应用——渲染判断定权"></a>高阶组件应用——渲染判断定权</h2><p>与上面的主要差距为，会对传入的参数进行判断来决定返回哪个子组件</p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327212646566.png" alt="image-20230327212646566"></p>
<h2 id="高阶组件应用——生命周期劫持"><a href="#高阶组件应用——生命周期劫持" class="headerlink" title="高阶组件应用——生命周期劫持"></a>高阶组件应用——生命周期劫持</h2><p>在高阶组件中劫持子组件的生命周期，在自己的生命周期中完成逻辑</p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/React%E7%BB%84%E4%BB%B6%E5%8C%96%E5%BC%80%E5%8F%91/image-20230327212743063.png" alt="image-20230327212743063"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>高阶组件的主要作用是提高代码的复用性。提高组件之间的复用</p>
<p><strong><em>缺陷：</em></strong></p>
<ul>
<li>HOC需要在原组件上进行包裹或者嵌套，如果大量使用HOC，将产生非常多的嵌套</li>
<li>HOC可以劫持props，在不遵从约定的情况下可能造成冲突</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAReact%E9%A1%B9%E7%9B%AE%E5%8F%8AReact%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAReact%E9%A1%B9%E7%9B%AE%E5%8F%8AReact%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">搭建一个React项目及React基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-24 15:29:50 / 修改时间：19:21:08" itemprop="dateCreated datePublished" datetime="2023-03-24T15:29:50+08:00">2023-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong><em>官网：</em></strong><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/">https://zh-hans.reactjs.org/</a></p>
<h1 id="React简单项目创建（React一）"><a href="#React简单项目创建（React一）" class="headerlink" title="React简单项目创建（React一）"></a>React简单项目创建（React一）</h1><h2 id="React特点"><a href="#React特点" class="headerlink" title="React特点"></a>React特点</h2><ul>
<li>声明书编程：只需要维护自己的状态，当状态改变时，React可以根据最新的状态去渲染UI界面</li>
<li>组件化开发：将复杂的界面拆分为一个个小的组件</li>
<li>多平台适配：React(Web)、ReactNative(移动端平台)、ReactVR(虚拟现实Web应用程序)——虚拟DOM也对跨平台有很大用处</li>
</ul>
<h2 id="React开发依赖"><a href="#React开发依赖" class="headerlink" title="React开发依赖"></a>React开发依赖</h2><ul>
<li><strong><em>react：</em></strong>react所必须的核心代码</li>
<li><strong><em>react-dom：</em></strong>react渲染在不同平台上所需要的核心代码——虚拟DOM→真实DOM（浏览器）/原生控件（移动端）</li>
<li><strong><em>babel：</em></strong>将jsx转换为React代码的工具，如果直接用React.createElement来写React对象，可以不用babel，同时可以将ES6转换为ES5语法</li>
</ul>
<p>react CDN引入：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react@18/umd/react.development.js&quot;</span> <span class="attr">crossorigin</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react-dom@18/umd/react-dom.development.js&quot;</span> <span class="attr">crossorigin</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/babel-standalone@6/babel.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="React第一个Hello-World"><a href="#React第一个Hello-World" class="headerlink" title="React第一个Hello World"></a>React第一个Hello World</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- root作为根节点--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> message = <span class="string">&quot;hello World&quot;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#root&#x27;</span>))</span></span><br><span class="line"><span class="language-javascript">    root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;message&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong><em>注：</em></strong></p>
<ul>
<li>script一定要设置 type=”text/babel” 否则不会被babel解析，jsx语法就不能识别</li>
<li>ReactDom.createRoot()是创建一个React根，不一定是整个html的根</li>
<li>render函数，参数是要渲染的组件</li>
<li>{}语法可以引入JavaScript语法</li>
</ul>
<h1 id="React组件化开发"><a href="#React组件化开发" class="headerlink" title="React组件化开发"></a>React组件化开发</h1><p><strong><em>组件化开发：</em></strong>root.render参数是一个HTML元素或一个组件，那么可以将复杂的业务逻辑封装到一个组件中，然后传入到ReactDom.render中</p>
<p><strong><em>React组件：</em></strong></p>
<ul>
<li>类组件与函数组件</li>
<li>根据内部是否有状态需要维护：无状态组件、有状态组件（this.state，不考虑hooks的情况下函数组件是无状态组件，而类组件不定义this.state也可以看做无状态组件）</li>
<li>根据组件的不同职责：展示型组件、容器型组件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>()</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">movies</span>:[<span class="string">&quot;盗梦空间&quot;</span>,<span class="string">&quot;星际穿越&quot;</span>,<span class="string">&quot;大话西游&quot;</span>,<span class="string">&quot;流浪地球&quot;</span>],</span><br><span class="line">            <span class="attr">currentIndex</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">clickLi</span>(<span class="params">event,index</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;<span class="attr">currentIndex</span>:index&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            	&#123;this.state.movies.map((item,index)=&gt;&#123;</span></span><br><span class="line"><span class="language-xml">           			 return( </span></span><br><span class="line"><span class="language-xml">                			<span class="tag">&lt;<span class="name">li</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                				<span class="attr">key</span>=<span class="string">&#123;item&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        						<span class="attr">onClick</span>=<span class="string">&#123;(event)</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">            						this.clickLi(event,index)</span></span><br><span class="line"><span class="language-xml">        						&#125;&#125; </span></span><br><span class="line"><span class="language-xml">    							className = &#123;index===this.state.currentIndex?&quot;active&quot;:&quot;&quot;&#125;&gt;&#123;item&#125;</span></span><br><span class="line"><span class="language-xml">    						<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    					)</span></span><br><span class="line"><span class="language-xml">				&#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#root&#x27;</span>))</span><br><span class="line">root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>)</span><br></pre></td></tr></table></figure>
<h2 id="数据依赖"><a href="#数据依赖" class="headerlink" title="数据依赖"></a>数据依赖</h2><ul>
<li><strong><em>参与界面更新的数据：</em></strong>当数据改变时，需要更新组件渲染的数据（调用this.setState更新数据会自动检测改变的变量，并重新执行render函数更新页面）——参与数据流，放入当前对象的state对象中</li>
<li><strong><em>不参与页面更新的数据：</em></strong>数据改变时，不需要更新页面的数据</li>
</ul>
<h2 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h2><p><strong><em>this指向问题：</em></strong></p>
<ul>
<li>babel默认严格模式，那么默认调用的函数的this为undefined</li>
<li>一般的button点击，this指向button本身，但是这里调用的button是一个React的Element对象，并不是页面中的button，是React内部调用响应函数，因此不知道如何绑定正确的this</li>
</ul>
<p><strong><em>绑定this方法：</em></strong></p>
<ul>
<li><p>bind方法：调用bind方法生成一个带特定this的函数赋值给onClick</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;this.changeText.bind(this)&#125;&gt; </span><br></pre></td></tr></table></figure>
</li>
<li><p>箭头函数方法：如上面代码，给onClick赋值一个箭头函数，在箭头函数中调用隐式绑定想要运行的函数，箭头函数由于没有this，会向上寻找到this即class对象</p>
</li>
</ul>
<p><strong><em>事件参数传递：</em></strong>点击函数会传入一个event，可以将event与其他的参数放在箭头函数里面调用函数时传给最后的响应函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li onClick=&#123;event=&gt;this.clickLi(event,&quot;oww&quot;,&quot;22&quot;)&#125;&gt;按钮&lt;/li&gt;</span><br></pre></td></tr></table></figure>
<h2 id="map映射"><a href="#map映射" class="headerlink" title="map映射"></a>map映射</h2><p>往往会从数据数组中得到要展示的Element列表，就可以使用map映射</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &#123;this.state.movies.map((item,index)=&gt;&#123;</span><br><span class="line">        return( </span><br><span class="line">            &lt;li </span><br><span class="line">                key=&#123;item&#125; </span><br><span class="line">                onClick=&#123;(event)=&gt;&#123;</span><br><span class="line">                    this.clickLi(event,index)</span><br><span class="line">                &#125;&#125; </span><br><span class="line">                className = &#123;index===this.state.currentIndex?&quot;active&quot;:&quot;&quot;&#125;&gt;&#123;item&#125;</span><br><span class="line">			&lt;/li&gt;</span><br><span class="line">		)</span><br><span class="line">	&#125;)&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h1 id="JSX语法"><a href="#JSX语法" class="headerlink" title="JSX语法"></a>JSX语法</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const element = &lt;div&gt;Hello World&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>类似于上诉代码的形式就是一个JSX代码</p>
<p><strong><em>React选择JSX的理由：</em></strong></p>
<ul>
<li><p>React认为渲染逻辑本质上与其他UI逻辑存在耦合（UI需要绑定事件、UI需要展示数据状态、状态改变时，又会改变UI）</p>
</li>
<li><p>因为渲染逻辑与UI逻辑的耦合，React没有将标记分离到不同的文件中，而是组合在一起形成组件</p>
</li>
</ul>
<p>注：JSX只能有一个根元素，也就是上面不能存在两个兄弟DIV，实在需要可以用数组[]包围，JSX中的单标签必须以/&gt;结尾</p>
<h3 id="JSX中的变量"><a href="#JSX中的变量" class="headerlink" title="JSX中的变量"></a>JSX中的变量</h3><ul>
<li>Number、String、Array可以直接显示</li>
<li>null、undefined、Boolean内容为空，如确实要显示，转换为字符串后使用</li>
<li>嵌入表达式使用（运算表达式、三元运算符、执行函数——是一个函数的执行得到返回值）</li>
<li>Object对象不能作为子元素</li>
</ul>
<h3 id="JSX绑定属性"><a href="#JSX绑定属性" class="headerlink" title="JSX绑定属性"></a>JSX绑定属性</h3><ul>
<li><strong><em>title属性/img的src属性/a元素href属性：</em></strong>直接使用title/src/href=””/{}</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const element = &lt;h2 title=&quot;h2&quot;&gt;哈哈哈&lt;/h2&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><em>class属性：</em></strong>小驼峰法className设置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const element = &lt;h2 className=&#123;&#x27;abc cba $&#123;isActive?&#x27;active&#x27;:&#x27;&#x27;&#125;&#x27;&#125;&gt;哈哈哈&lt;/h2&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><em>内联style属性：</em></strong>style=””/{}设置——外层{}是JSX语法，里层{}是包裹对象，font-size要用小驼峰法fontSize</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const element= &lt;h2 style=&#123;&#123;color:&quot;red&quot;, fontSize:&quot;30px&quot;&#125;&#125;&gt;哈哈哈&lt;/h2&gt;</span><br></pre></td></tr></table></figure>
<h3 id="JSX本质"><a href="#JSX本质" class="headerlink" title="JSX本质"></a>JSX本质</h3><p>JSX实际上是React.createElement的语法糖，下面两种方法等效，label会将JSX转换为React对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const element = React.createElement(&#x27;div&#x27;,&#123;class:&quot;active&quot;,style=&#123;color:&quot;red&quot;&#125;&#125;,children)</span><br><span class="line">const element = &lt;div className = &quot;active&quot; style=&#123;&#123;color:&quot;red&quot;&#125;&#125;&gt;children1,children2&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h1 id="虚拟DOM"><a href="#虚拟DOM" class="headerlink" title="虚拟DOM"></a>虚拟DOM</h1><ul>
<li><p>通过React.createElement最终可以创建出一个ReactElement对象，其与其子元素构成一个对象树，这个树就是<strong>虚拟DOM</strong></p>
</li>
<li><p>React从JSX到真实DOM的流程：</p>
<p><img src="/2023/03/24/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAReact%E9%A1%B9%E7%9B%AE%E5%8F%8AReact%E5%9F%BA%E7%A1%80/image-20230324165543425.png" alt="image-20230324165543425"></p>
</li>
</ul>
<h2 id="虚拟DOM帮助实现声明式编程"><a href="#虚拟DOM帮助实现声明式编程" class="headerlink" title="虚拟DOM帮助实现声明式编程"></a>虚拟DOM帮助实现声明式编程</h2><p><strong><em>虚拟DOM：</em></strong>虚拟DOM是一种编程理念</p>
<ul>
<li>UI以一种虚拟化的方式保存在内存中，是一个较为简单的JavaScript对象</li>
<li>通过ReactDom.render函数让虚拟DOM与真实DOM同步起来，这一个步骤叫做协调</li>
<li>更新状态后整体刷新，而不是原生的局部刷新</li>
</ul>
<p><strong><em>Diff算法：</em></strong>如果简单的整体刷新会导致项目运行效率较低</p>
<ul>
<li>Diff算法对于没有改变的DOM节点，保持原样不动，仅仅创建并替换变更过的DOM节点，实现DOM节点复用</li>
<li>因此需要实现DOM节点的版本控制，如果对原生的DOM节点进行版本控制，会有大量的DOM查询操作，所以React将DOM的diff操作转移到轻量js对象上，可以避免大量的DOM操作，这个轻量的js对象就是虚拟DOM</li>
</ul>
<p><strong><em>实现过程：</em></strong></p>
<ul>
<li>维护一个使用JS对象表示的虚拟DOM，与真实DOM一一对应</li>
<li>对前后的虚拟DOM做diff操作，找到变化的虚拟DOM</li>
<li>将变化的DOM应用于真实DOM（<strong>不是不操作DOM，而是对DOM的操作次数降到最低</strong>）</li>
</ul>
<h3 id="React的声明式编程"><a href="#React的声明式编程" class="headerlink" title="React的声明式编程"></a>React的声明式编程</h3><ul>
<li>通过虚拟DOM表示希望UI是什么状态</li>
<li>React确保DOM和这些状态匹配</li>
<li>不需要直接进行DOM操作，而去改变虚拟DOM，从手动更改DOM、属性操作、事件处理中解放出来（传统的DOM API太多，操作复杂，容易出现Bug，代码不易维护），用户只需要关心状态和最终的UI样式</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/CSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/CSS/" class="post-title-link" itemprop="url">CSS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-23 21:17:45" itemprop="dateCreated datePublished" datetime="2023-03-23T21:17:45+08:00">2023-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-02 17:17:14" itemprop="dateModified" datetime="2023-05-02T17:17:14+08:00">2023-05-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CSS基础"><a href="#CSS基础" class="headerlink" title="CSS基础"></a>CSS基础</h1><h2 id="CSS样式"><a href="#CSS样式" class="headerlink" title="CSS样式"></a>CSS样式</h2><ul>
<li>内联样式（元素的style属性中）</li>
<li>内部样式表（HTML的style元素中）</li>
<li>外部样式表（.css文件中，通过link元素导入）</li>
</ul>
<h2 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h2><p><strong><em>text-decoration：</em></strong>none(无装饰线)、underline(下划线)、overline(上划线)、through(中划线/删除线)</p>
<p><strong><em>text-transform：</em></strong>capitaliza(每个单词首字母大写)、uppercase(每个单词字符变为大写)、lowercase(每个单词字符变小写)、none(没有影响)</p>
<p><strong><em>text-indent：</em></strong>（em/px）第一行内容的缩进——em是当前文字的大小，2em就是两个文字</p>
<p><strong><em>text-align：</em></strong>left(左对齐)、right(右对齐)、center(居中对齐)、justify(两端对齐)</p>
<ul>
<li>行内级元素的对齐方式</li>
<li>display:inline与width、height不能同时设置，行内级元素没有宽高（高度为line-height）</li>
</ul>
<p><strong><em>letter-spacing/word-spacing：</em></strong>分别设置字母、单词之间的间距（默认是0，可以为负数）</p>
<h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><p><strong><em>font-size：</em></strong>字体大小</p>
<ul>
<li>具体数值加单位：100px、1em（em是父元素计算后的font-size）</li>
<li>百分比：基于父元素font-size计算</li>
</ul>
<p><strong><em>font-family：</em></strong>字体名称（一般设置一个，继承下去）</p>
<p><strong><em>font-wight：</em></strong>加粗 100|200|300|400|500|600|700|800|900   normal是400   bold是700</p>
<p><strong><em>font-style：</em></strong>斜体 normal(常规显示)、italic(用字体的斜体显示)、oblique(文本倾斜显示)</p>
<p><strong><em>font-variant：</em></strong>normal(常规显示)、small-caps(小写字母替换为缩小后的大写字母)</p>
<p><strong><em>line-height☆：</em></strong></p>
<ul>
<li>一行文字所占的高度</li>
<li>两行文字基线之间的间距</li>
<li><p>基线：与小写字母x最底部对齐的线</p>
</li>
<li><p>line-height实现文字垂直居中：line-height=height</p>
</li>
</ul>
<p><strong><em>display：</em></strong>block、inline（不可以随意设置宽高）、inline-block、flex</p>
<p>元素隐藏方法：</p>
<ul>
<li><strong>display:none</strong>；   元素不显示出来，不占据空间（和不存在一样）</li>
<li><strong>visivility:hidden;</strong>   元素不可见，但占据空间</li>
<li><strong>rgba设置a为0</strong>   设置alpha值，透明度，不会影响子元素</li>
<li><strong>opacity设置为0</strong>   会影响所有的子元素</li>
</ul>
<p>注：raba和opacity设置时，文字根据opacity显示</p>
<h2 id="常见选择器"><a href="#常见选择器" class="headerlink" title="常见选择器"></a>常见选择器</h2><ul>
<li>!important：10000</li>
<li>内联样式：1000</li>
<li>id选择器：100</li>
<li>类选择器、属性选择器、伪类：10</li>
<li>元素选择器、伪元素：1</li>
<li>通配符：0</li>
</ul>
<p>可以简单认为：选择器查询到的结果越多，权重越低</p>
<h3 id="css设置不生效："><a href="#css设置不生效：" class="headerlink" title="css设置不生效："></a>css设置不生效：</h3><ul>
<li>选择器优先级太低</li>
<li>选择器没选中对应的元素</li>
<li>css使用形式不对（例如行内级元素的宽高、被同类型css属性覆盖）</li>
</ul>
<h1 id="盒子模型"><a href="#盒子模型" class="headerlink" title="盒子模型"></a>盒子模型</h1><p><strong><em>宽高：</em></strong>width/height、min-height/max-height、max-width/min-height(移动端适配)</p>
<p><strong><em>padding：</em></strong>padding-top、padding-right、padding-bottom、padding-left</p>
<ul>
<li>10px 20px 30px 40px  分别对应：top、right、bottom、left</li>
<li>10px 20px 30px   缺少left，left使用right的值</li>
<li>10px 20px  缺少bottom、left分别使用top、right的值</li>
<li>10px  其余值都用这个值</li>
</ul>
<p><strong><em>border：</em></strong></p>
<ul>
<li>border-top-width、border-right-width、border-bottom-width、border-left-width</li>
<li>border-top-color、border-right-color、border-bottom-color、border-left-color</li>
<li>border-top-style、border-right-style、border-bottom-style、border-left-style</li>
<li>border-top、border-right、border-bottom、border-left</li>
<li>border-radius</li>
</ul>
<p>注：同样可以用border属性来进行缩写</p>
<p><strong><em>out-line:</em></strong></p>
<p>外轮廓不占用空间、border占用空间，外轮廓默认显示在border的外面</p>
<ul>
<li>outline-width: 外轮廓的宽度 </li>
<li>outline-style：取值跟border的样式一样，比如solid、dotted等 </li>
<li>outline-color: 外轮廓的颜色 </li>
<li>outline：outline-width、outline-style、outline-color的简写属性，跟border用法类似</li>
</ul>
<p><strong>作用：</strong>去除a元素，input元素的focus轮廓效果</p>
<p><strong><em>margin：</em></strong>与padding值的设置类似</p>
<h2 id="margin的上下传递（左右不传递）——父子元素"><a href="#margin的上下传递（左右不传递）——父子元素" class="headerlink" title="margin的上下传递（左右不传递）——父子元素"></a>margin的上下传递（左右不传递）——父子元素</h2><h3 id="margin-top传递"><a href="#margin-top传递" class="headerlink" title="margin-top传递"></a>margin-top传递</h3><p><strong><em>html代码：</em></strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>哈哈哈哈<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong><em>样式设置：</em></strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: orange;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果块级元素的顶部线和父元素的顶部线重叠，那么这个块级元素的margin-top值会传递给父元素</li>
</ul>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/CSS/image-20230325163555417.png" alt="image-20230325163555417"></p>
<p>如果没有折叠，应该是块级元素与父元素组件有间隔，但实际上margin-top值传递给了父元素</p>
<h3 id="margin-bottom传递"><a href="#margin-bottom传递" class="headerlink" title="margin-bottom传递"></a>margin-bottom传递</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">height</span>: auto;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: orange;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果块级元素的底部线和父元素的底部线重写，并且父元素的高度是auto，那么这个块级元素的margin-bottom值会传递给父元素</li>
</ul>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/CSS/image-20230325163706773.png" alt="image-20230325163706773"></p>
<p>如果没有折叠，应该是块级元素与父元素组件有间隔，但实际上margin-bottom值传递给了父元素</p>
<h3 id="防止margin传递"><a href="#防止margin传递" class="headerlink" title="防止margin传递"></a>防止margin传递</h3><ul>
<li>给父元素设置padding-top\padding-bottom （必须额外添加padding）</li>
<li>给父元素设置border   （有时候boder影响样式，设置boder透明依然会占据空间）</li>
<li>触发BFC: 设置overflow为auto</li>
</ul>
<h2 id="margin的上下折叠——兄弟父子都有"><a href="#margin的上下折叠——兄弟父子都有" class="headerlink" title="margin的上下折叠——兄弟父子都有"></a>margin的上下折叠——兄弟父子都有</h2><ul>
<li>垂直方向上相邻的2个margin（margin-top、margin-bottom）有可能会合并为1个margin，这种现象叫做collapse（折叠）</li>
<li>水平方向上的margin（margin-left、margin-right）永远不会collapse</li>
<li>折叠后最终值的计算规则：  两个值进行比较，取较大的值</li>
<li>防止上下折叠：只设置其中一个元素的margin</li>
</ul>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/CSS/image-20230325164329528.png" alt="image-20230325164329528"></p>
<h1 id="元素水平居中方案"><a href="#元素水平居中方案" class="headerlink" title="元素水平居中方案"></a>元素水平居中方案</h1><p><strong><em>父元素一般为块级元素、inline-block：</em></strong></p>
<ul>
<li>行内级元素：text-align:center</li>
<li>块级元素：margin:0 auto</li>
</ul>
<h1 id="元素的宽度公式："><a href="#元素的宽度公式：" class="headerlink" title="元素的宽度公式："></a>元素的宽度公式：</h1><p>元素实际占用宽度 = border + padding + width</p>
<p>元素实际占用高度 = border + padding + height</p>
<h2 id="普通块级元素"><a href="#普通块级元素" class="headerlink" title="普通块级元素"></a>普通块级元素</h2><ul>
<li><p>父元素宽度 = 子元素宽度+margin-left+margin-right</p>
</li>
<li><p>父元素高度 = 子元素高度+margin-top+margin-bottom</p>
</li>
</ul>
<h3 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h3><ul>
<li>父元素宽高知道、margin-left，margin-right设置为0，则子元素宽度auto为赋值为父元素宽度——高度不适用</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.container</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">800px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.context</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;context&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/CSS/image-20230420200031708.png" alt="image-20230420200031708"></p>
<ul>
<li><p>父元素宽高知道，子元素宽度知道，margin-left，margin-right设置为auto会自动对半分，则可以水平居中——只针对block生效</p>
</li>
<li><p>少在高度上使用这个公式，因为浏览器对margin-top，margin-bottom的处理有些特殊</p>
</li>
</ul>
<h2 id="绝对定位元素（absolute-fixed）"><a href="#绝对定位元素（absolute-fixed）" class="headerlink" title="绝对定位元素（absolute/fixed）"></a>绝对定位元素（absolute/fixed）</h2><ul>
<li><p>定位参照对象的宽度 = left + right + margin-left + margin-right + 绝对定位元素的实际占用宽度</p>
</li>
<li><p>定位参照对象的高度 = top + bottom + margin-top + margin-bottom + 绝对定位元素的实际占用高度</p>
</li>
</ul>
<h3 id="使用案例-1"><a href="#使用案例-1" class="headerlink" title="使用案例"></a>使用案例</h3><ul>
<li>父元素宽高知道，子元素宽度知道，left 、right 、 margin-left 、 margin-right均设置为0，则子元素高度auto为赋值为父元素宽度——宽度同样使用</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.container</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">800px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.context</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: orange;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;context&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/CSS/image-20230420201531432.png" alt="image-20230420201531432"></p>
<ul>
<li>父元素宽高知道，子元素宽高知道，left、right设置为0，margin-left，margin-right设置为auto会自动对半分——高度同样适用</li>
</ul>
<h1 id="CSS中元素的定位"><a href="#CSS中元素的定位" class="headerlink" title="CSS中元素的定位"></a>CSS中元素的定位</h1><p><strong><em>标准流：</em></strong>默认情况下，元素都是按照normal flow（标准流、常规流、正常流、文档流【document flow】）进行排布</p>
<ul>
<li>从左到右、从上到下按顺序摆放好</li>
<li>默认情况下，互相之间不存在层叠现象</li>
<li>标准流可以用margin-padding进行位置的调整<ul>
<li>设置一个元素的margin或者padding，通常会影响到标准流中其他元素的定位效果</li>
<li>不便于实现元素层叠的效果</li>
</ul>
</li>
</ul>
<h2 id="position属性"><a href="#position属性" class="headerlink" title="position属性"></a>position属性</h2><h3 id="默认值（static）："><a href="#默认值（static）：" class="headerlink" title="默认值（static）："></a>默认值（static）：</h3><ul>
<li>元素按照normal flow布局</li>
<li>left 、right、top、bottom没有任何作用</li>
</ul>
<h2 id="相对定位（relative）"><a href="#相对定位（relative）" class="headerlink" title="相对定位（relative）"></a>相对定位（relative）</h2><ul>
<li>元素按照normal flow布局</li>
<li>可以通过left、right、top、bottom进行定位<ul>
<li>定位参照对象是元素自己原来的位置</li>
</ul>
</li>
<li>left、right、top、bottom用来设置元素的具体位置，对元素的作用如下图所示</li>
<li><strong><em>应用场景：</em></strong>在不影响其他元素位置的前提下，对当前元素位置进行微调</li>
</ul>
<h2 id="固定定位（fixed）"><a href="#固定定位（fixed）" class="headerlink" title="固定定位（fixed）"></a>固定定位（fixed）</h2><ul>
<li>元素脱离normal flow（脱离标准流、脱标）</li>
<li>可以通过left、right、top、bottom进行定位</li>
<li>定位参照对象是视口（viewport）</li>
<li>当画布滚动时，固定不动</li>
</ul>
<h2 id="绝对定位（absolute）："><a href="#绝对定位（absolute）：" class="headerlink" title="绝对定位（absolute）："></a>绝对定位（absolute）：</h2><ul>
<li>元素脱离normal flow（脱离标准流、脱标）——脱标前的元素不变，脱标元素会放在之前的元素后面，但是后面的元素会当脱标元素不存在（不更改top等的值）</li>
<li>可以通过left、right、top、bottom进行定位<ul>
<li>定位参照对象是最邻近的定位祖先元素</li>
<li>如果找不到这样的祖先元素，参照对象是视口</li>
</ul>
</li>
<li>定位元素（positioned element）<ul>
<li>position值不为static的元素</li>
<li>也就是position值为relative、absolute、fixed的元素</li>
</ul>
</li>
</ul>
<h3 id="position为absolute-fixed元素的特点（绝对定位元素）"><a href="#position为absolute-fixed元素的特点（绝对定位元素）" class="headerlink" title="position为absolute/fixed元素的特点（绝对定位元素）"></a>position为absolute/fixed元素的特点（绝对定位元素）</h3><ul>
<li><p>可以随意设置宽高——position为relative的不能</p>
</li>
<li><p>宽高默认由内容决定</p>
</li>
<li><p>不再受标准流的约束 </p>
<ul>
<li><p>不再严格按照从上到下、从左到右排布 </p>
</li>
<li><p>不再严格区分块级(block)、行内级(inline)，行内块级(inline-block)的很多特性都会消失——同样position为relative的不能</p>
</li>
</ul>
</li>
<li><p>不再给父元素汇报宽高数据——不会撑起父元素，如下面代码的div高度会为空</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">position</span>:absolute;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">div</span>&#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>哈哈哈<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>脱标元素内部默认还是按照标准流布局</li>
</ul>
<h2 id="粘性定位（sticky）"><a href="#粘性定位（sticky）" class="headerlink" title="粘性定位（sticky）"></a>粘性定位（sticky）</h2><ul>
<li>可以看做是相对定位和固定(绝对)定位的结合体</li>
<li>它允许被定位的元素表现得像相对定位一样，直到它滚动到某个阈值点</li>
<li>它允许被定位的元素表现得像相对定位一样，直到它滚动到某个阈值点</li>
<li>sticky是相对于最近的滚动祖先包含滚动视口的(</li>
</ul>
<h1 id="浮动float"><a href="#浮动float" class="headerlink" title="浮动float"></a>浮动float</h1><p><strong><em>以前多列布局的常用方案</em></strong></p>
<ul>
<li>脱离标准流</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/JavaScript%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/JavaScript%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">JavaScript运行原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-23 18:41:46" itemprop="dateCreated datePublished" datetime="2023-03-23T18:41:46+08:00">2023-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-05 10:19:04" itemprop="dateModified" datetime="2023-04-05T10:19:04+08:00">2023-04-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong><em>浏览器内核（以webkit为例）：</em></strong>WebCore负责解析HTML、布局、渲染等；JavaScriptCore：解析、执行JavaScript代码</p>
<p><strong><em>ECMAScript3：</em></strong>用这个来学习JavaScript执行、作用域、作用域链、闭包等概念</p>
<p><strong><em>ECMAScript5：</em></strong>用这个来学习块级作用域、let、const等概念</p>
<p>两者概念描述不一样，整体思路一致</p>
<h1 id="V8引擎的执行原理"><a href="#V8引擎的执行原理" class="headerlink" title="V8引擎的执行原理"></a>V8引擎的执行原理</h1><p>V8是用C++编写的开源高性能JavaScript和WebAssembly引擎，可以用于Chrome和Node.js</p>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/JavaScript%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/image-20230323184747752.png" alt="image-20230323184747752"></p>
<p><strong><em>Parse：</em></strong>将JavaScript代码转换为AST（抽象语法树）——函数在没调用的时候，不会被转换为抽象语法树</p>
<p><strong><em>Ignition：</em></strong>将AST转换为字节码</p>
<p><strong><em>TurboFan：</em></strong>将字节码编译为可以直接运行的机器码</p>
<ul>
<li>如果一个函数被多次调用，就会被标记为热点函数，就会被TurboFan转换为机器码，提高代码的执行性能</li>
<li>机器码也会被还原为ByteCode，如果后续执行函数的过程中，类型发生了变化，之前的机器码不能进行准确的运算，就会逆向转换为字节码</li>
</ul>
<h2 id="JavaScript执行过程"><a href="#JavaScript执行过程" class="headerlink" title="JavaScript执行过程"></a>JavaScript执行过程</h2><p><strong><em>执行上下文栈（ECS）：</em></strong>js引擎内部有一个执行上下文栈，是执行代码的调用栈</p>
<p><strong><em>全局执行上下文：</em></strong>全局代码块为了执行会生成一个全局执行上下文（GEC），并放入ECS中</p>
<p><strong><em>函数执行上下文：</em></strong>执行到一个函数值，会根据函数体创建一个函数执行上下文（FEC），并放入到ECS中</p>
<p><strong><em>AO对象：</em></strong>当进入一个函数执行上下文时，会创建一个AO对象，AO对象使用arguments作为初始化，初始值是传入的参数</p>
<p><strong><em>VO对象：</em></strong>每一个执行上下文都会关联一个VO（Variable Object）对象，变量和函数的声明会被添加到这个VO对象中</p>
<p><strong><em>注：</em></strong>全局上下文的VO对象就是GO、函数执行上下文的VO对象是AO</p>
<h3 id="初始化全局对象"><a href="#初始化全局对象" class="headerlink" title="初始化全局对象"></a>初始化全局对象</h3><p>js在执行代码前，会在堆内存中创建一个全局对象：Global Object（GO）</p>
<ul>
<li>该对象所有的作用域（scope）都可以访问； </li>
<li>里面会包含Date、Array、String、Number、setTimeout、setInterval等等； </li>
<li>其中还有一个window属性指向自己；</li>
</ul>
<p>在parser转成AST的过程中，会将全局定义的变量、函数等放入GlobalObject中，但不会赋值（变量的作用域提升）</p>
<ul>
<li>JavaScript可以在变量声明前访问，但是值是undefined，浏览器会对函数进行特殊处理，使得其可以在定义前调用</li>
</ul>
<p>在代码执行过程中，对变量赋值或者执行其他的函数</p>
<p>全局代码执行前：</p>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/JavaScript%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/image-20230323191418551.png" alt="image-20230323191418551"></p>
<p>全局代码执行后：</p>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/JavaScript%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/image-20230323191040277.png" alt="image-20230323191040277"></p>
<p>函数执行前：</p>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/JavaScript%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/image-20230323191504578.png" alt="image-20230323191504578"></p>
<p>函数执行后：</p>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/JavaScript%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/image-20230323191448418.png" alt="image-20230323191448418"></p>
<h1 id="作用域和作用域链"><a href="#作用域和作用域链" class="headerlink" title="作用域和作用域链"></a>作用域和作用域链</h1><p><strong><em>作用域链：</em></strong>当进入到一个执行上下文时，执行上下文会关联一个作用域链，并根据代码类型，添加一系列的对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">age</span>)&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(age)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bar</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> baz = <span class="title function_">foo</span>(<span class="number">18</span>)</span><br><span class="line"><span class="title function_">baz</span>()</span><br></pre></td></tr></table></figure>
<p><img src="/2023/03/23/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/JavaScript%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/image-20230323192141405.png" alt="image-20230323192141405"></p>
<ul>
<li>其作用域链中有两个，分别是foo的作用域、全局作用域</li>
</ul>
<p>注：作用域链是在函数声明是产生的，与调用时刻无关</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">浏览器优化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-22 22:25:52" itemprop="dateCreated datePublished" datetime="2023-03-22T22:25:52+08:00">2023-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-04 20:13:17" itemprop="dateModified" datetime="2023-04-04T20:13:17+08:00">2023-04-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="回流reflow和重绘repaint"><a href="#回流reflow和重绘repaint" class="headerlink" title="回流reflow和重绘repaint"></a>回流reflow和重绘repaint</h1><h2 id="回流"><a href="#回流" class="headerlink" title="回流"></a>回流</h2><p>第一次确定节点的大小和位置，称为布局</p>
<p>后续对节点的大小、位置修改并重新计算称为回流</p>
<h3 id="引起回流的情况"><a href="#引起回流的情况" class="headerlink" title="引起回流的情况"></a>引起回流的情况</h3><ul>
<li>DOM结构发生变化（添加或删除节点）</li>
<li>改变布局（修改width、height、padding、font-size等）</li>
<li>修改窗口大小</li>
<li>调用getComputedStyle方法获取尺寸、位置星系、</li>
</ul>
<h3 id="避免回流的方法"><a href="#避免回流的方法" class="headerlink" title="避免回流的方法"></a>避免回流的方法</h3><p>修改样式时尽量一次性修改，比如通过cssText修改，或者通过添加class修改，而不是对css的各种属性分次修改</p>
<p>避免频繁的操作DOM，可以使用虚拟DOM，或在父元素中要操作的DOM完成，再一次性更新到DOM中</p>
<h4 id="composite合成"><a href="#composite合成" class="headerlink" title="composite合成"></a>composite合成</h4><p>绘制的过程中，浏览器会将布局后的元素绘制到多个图层中</p>
<p>默认情况下，标准流中的内容被绘制在同一个图层，对于某些特殊的属性，会创建一个新的图层，这些图层可以利用GPU加速绘制</p>
<p>可以形成新的合成层的属性：3D transforms、video、canvas、iframe、opacity、position：fixed、will-change、animation或transition设置了opacity、transform</p>
<p>分层确实可以提高性能，但以内存管理为代价，因此不能作为Web性能优化的一部分过渡使用</p>
<h2 id="重绘"><a href="#重绘" class="headerlink" title="重绘"></a>重绘</h2><p>第一次渲染内容称为绘制</p>
<p>后续重新渲染称为重绘</p>
<h3 id="引起重绘的情况"><a href="#引起重绘的情况" class="headerlink" title="引起重绘的情况"></a>引起重绘的情况</h3><p>修改背景颜色、文字颜色、边框颜色、样式等</p>
<p>注：回流一定引起重绘、因此回流是一件很消耗性能的事情，所以开发中要避免回流</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ouwenwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ouwenwu">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">浏览器渲染原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-22 21:38:42" itemprop="dateCreated datePublished" datetime="2023-03-22T21:38:42+08:00">2023-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-04 20:14:50" itemprop="dateModified" datetime="2023-04-04T20:14:50+08:00">2023-04-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="网页解析过程："><a href="#网页解析过程：" class="headerlink" title="网页解析过程："></a>网页解析过程：</h1><p><img src="/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/image-20230322214252101.png" alt="image-20230322214252101"></p>
<p><img src="/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/image-20230322215014488.png" alt="image-20230322215014488"></p>
<h2 id="HTML解析过程"><a href="#HTML解析过程" class="headerlink" title="HTML解析过程"></a>HTML解析过程</h2><p>默认情况下服务器给浏览器返回index.html文件，因此解析HTML是所有步骤的开始，解析HTML过程会构建Dom Tree</p>
<p><img src="/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/image-20230322215643759.png" alt="image-20230322215643759"></p>
<h2 id="生成CSS规则"><a href="#生成CSS规则" class="headerlink" title="生成CSS规则"></a>生成CSS规则</h2><p>在解析过程中，如果遇到CSS的link元素，会有浏览器下载对应的CSS文件（不会影响DOM）的解析</p>
<p>对CSS下载完成后，会对CSS文件进行解析，解析出规则树，即CSSOM</p>
<p><img src="/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/image-20230322220941332.png" alt="image-20230322220941332"></p>
<h2 id="构建Render-Tree"><a href="#构建Render-Tree" class="headerlink" title="构建Render Tree"></a>构建Render Tree</h2><p>当DOM Tree和CSSOM Tree有了过后就可以两者结合构建Render Tree了</p>
<p><img src="/2023/03/22/%E5%89%8D%E7%AB%AF%E7%A8%8B%E5%BA%8F%E7%BC%96%E5%86%99/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/image-20230322221500301.png" alt="image-20230322221500301"></p>
<p>注：link元素不会阻塞DOM Tree的构建，但会阻塞Render Tree的构建</p>
<p>​        Render Tree和Dom Tree并不是一一对应的关系，对于display为none的元素，不会出现在Render Tree中</p>
<h2 id="布局和绘制"><a href="#布局和绘制" class="headerlink" title="布局和绘制"></a>布局和绘制</h2><p>渲染树会显示每个节点的样式，但不会给出每个节点的尺寸和位置，布局就是确定渲染树中每个节点的宽度、高度和位置信息</p>
<p>绘制就是将布局阶段计算的每个frame转为屏幕上实际的像素点，包括将元素的可见部分进行绘制，比如文本、颜色、边框、阴影、替换元素</p>
<h2 id="script元素和页面解析的关系"><a href="#script元素和页面解析的关系" class="headerlink" title="script元素和页面解析的关系"></a>script元素和页面解析的关系</h2><p>在HTML解析过程中，遇到script元素是不能继续构建DOM Tree的；会首先下载JavaScript代码，并执行脚本，等脚本执行结束后，继续解析HTML，构建DOM Tree</p>
<p><strong><em>原因：</em></strong> JavaScript的一个作用是操作DOM，并修改DOM，如果等DOM Tree构建完成后执行JavaScript，会引起严重的回流和重绘，影像性能</p>
<p><strong><em>但是：</em></strong> 目前的Vue/React开发模式，脚本比HTML页面更重，等到JavaScript解析会造成页面阻塞，在脚本执行完成钱，用户在界面上看不到任何东西</p>
<h3 id="script解析优化：defer、async"><a href="#script解析优化：defer、async" class="headerlink" title="script解析优化：defer、async"></a>script解析优化：defer、async</h3><p><strong><em>defer：</em></strong> 浏览器不需要等到脚本下载，继续解析HTML，构建DOM Tree  </p>
<p>​              不会阻塞DOm Tree的构建，等到DOM Tree构建完成后，在DOMContentLoaded事件之前执行代码</p>
<p>​               带多个defer的脚本按顺序执行</p>
<p>​               从某种角度来说，defer可以提高性能，并且推荐放到head元素中</p>
<p>​                注：defer仅适用于外部脚本，对于script默认内容会忽略</p>
<p><strong><em>async：</em></strong>  脚本完全独立</p>
<p>​                浏览器不会因async阻塞</p>
<p>​                async不能保证不同脚本之间的顺序，独立下载、运行</p>
<p>​                async不能保证在DOMcontentLoaded之前或之后运行</p>
<p><strong><em>defer通常用于文档解析后会操作DOM的JavaScript代码，并且对多个script文件有顺序要求的</em></strong></p>
<p><strong><em>async通常用于独立的脚本，对其他脚本，DOM没有依赖的</em></strong></p>
<h2 id="回流和重绘（见浏览器优化）"><a href="#回流和重绘（见浏览器优化）" class="headerlink" title="回流和重绘（见浏览器优化）"></a>回流和重绘（见浏览器优化）</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ouwenwu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ouwenwu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

  


    </div>
</body>
</html>
